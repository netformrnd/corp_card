<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë²•ì¸ì¹´ë“œ ê³ ì •ì§€ì¶œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #1B2A4A; --primary-light: #2C4A7C;
    --accent: #3B82F6; --accent-soft: #DBEAFE; --accent-hover: #2563EB;
    --surface: #FFFFFF; --bg: #F1F5F9; --bg-warm: #F8FAFC;
    --text: #1E293B; --text-secondary: #64748B; --text-muted: #94A3B8;
    --border: #E2E8F0; --border-light: #F1F5F9;
    --success: #10B981; --success-bg: #ECFDF5;
    --warning: #F59E0B; --warning-bg: #FFFBEB;
    --danger: #EF4444; --danger-bg: #FEF2F2;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.05);
    --shadow-lg: 0 10px 25px -5px rgba(0,0,0,0.08), 0 8px 10px -6px rgba(0,0,0,0.04);
    --radius: 12px; --radius-sm: 8px;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Pretendard','Noto Sans KR',-apple-system,sans-serif; background: var(--bg); color: var(--text); line-height: 1.7; -webkit-font-smoothing: antialiased; }

  /* â”€â”€ Sticky Header â”€â”€ */
  .top-header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); padding: 0 30px; height: 56px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
  .top-header h1 { font-size: 1.05rem; font-weight: 700; color: #fff; letter-spacing: -0.3px; }
  .hdr-right { display: flex; align-items: center; gap: 10px; }
  .sync-status { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: rgba(255,255,255,0.6); }
  .sync-dot { width: 8px; height: 8px; border-radius: 50%; }
  .sync-dot.online { background: #34D399; box-shadow: 0 0 8px rgba(52,211,153,.5); animation: pulse 2s infinite; }
  .sync-dot.offline { background: #ef4444; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
  .hdr-btn { padding: 6px 14px; border-radius: 6px; font-size: 0.78rem; font-weight: 600; cursor: pointer; font-family: inherit; border: none; background: rgba(255,255,255,.08); color: #94A3B8; border: 1px solid rgba(255,255,255,.12); transition: all .15s; }
  .hdr-btn:hover { background: rgba(255,255,255,.15); color: #fff; }

  /* â”€â”€ Container â”€â”€ */
  .container { max-width: 1200px; margin: 0 auto; padding: 20px 24px 60px; }

  /* â”€â”€ Mode Switch (ì§ì›/ê²½ì˜ê´€ë¦¬íŒ€) â”€â”€ */
  .mode-switch { display: flex; gap: 4px; background: var(--surface); border-radius: var(--radius); padding: 5px; box-shadow: var(--shadow-lg); border: 1px solid var(--border); margin-bottom: 20px; }
  .mode-btn { flex: 1; padding: 12px 16px; border: none; background: transparent; font-family: inherit; font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; border-radius: var(--radius-sm); transition: all 0.25s; }
  .mode-btn:hover { background: var(--bg); color: var(--text); }
  .mode-btn.active { background: var(--accent); color: #fff; font-weight: 600; box-shadow: 0 2px 8px rgba(59,130,246,0.3); }

  /* â”€â”€ Team Selector â”€â”€ */
  .team-selector { background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow-sm); padding: 20px 24px; margin-bottom: 20px; }
  .team-selector-title { font-size: 14px; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
  .team-tabs { display: flex; gap: 6px; flex-wrap: wrap; }
  .team-tab { padding: 8px 18px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--surface); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; color: var(--text-secondary); display: flex; align-items: center; gap: 6px; }
  .team-tab:hover { border-color: var(--accent); color: var(--accent); }
  .team-tab.active { background: var(--accent); color: #fff; border-color: var(--accent); }
  .team-tab .team-dot { width: 8px; height: 8px; border-radius: 50%; }
  .team-tab .team-count { font-size: 11px; background: rgba(0,0,0,0.08); padding: 1px 7px; border-radius: 10px; }
  .team-tab.active .team-count { background: rgba(255,255,255,0.25); }
  .quick-join { display: inline-flex; align-items: center; gap: 8px; margin-top: 12px; padding: 10px 16px; background: var(--bg-warm); border: 1px solid var(--border); border-radius: var(--radius-sm); }
  .quick-join input { padding: 7px 12px; border: 1px solid var(--border); border-radius: 6px; font-family: inherit; font-size: 13px; width: 130px; }
  .quick-join input:focus { outline: none; border-color: var(--accent); }

  /* â”€â”€ Tabs (within each mode) â”€â”€ */
  .sub-tabs { display: flex; gap: 4px; margin-bottom: 20px; }
  .sub-tab { padding: 10px 20px; border: none; background: var(--surface); border: 1px solid var(--border); font-family: inherit; font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; border-radius: var(--radius-sm); transition: all 0.2s; }
  .sub-tab:hover { background: var(--bg); color: var(--text); }
  .sub-tab.active { background: var(--primary); color: #fff; border-color: var(--primary); }

  /* â”€â”€ Card â”€â”€ */
  .card { background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow-sm); padding: 28px; margin-bottom: 20px; }
  .card-title { font-size: 15px; font-weight: 700; color: var(--primary); margin-bottom: 14px; display: flex; align-items: center; gap: 10px; }
  .card-title .icon { width: 30px; height: 30px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
  .card-title .icon.blue { background: var(--accent-soft); }
  .card-title .icon.green { background: var(--success-bg); }
  .card-title .icon.yellow { background: var(--warning-bg); }
  .card-title .icon.red { background: var(--danger-bg); }
  .card-title .icon.purple { background: #EDE9FE; }

  .notice-text { font-size: 14px; color: var(--text); line-height: 1.8; }

  .change-box { background: linear-gradient(135deg,#FFF7ED,#FFFBF0); border: 1px solid #FED7AA; border-left: 4px solid var(--warning); border-radius: 0 var(--radius-sm) var(--radius-sm) 0; padding: 20px 24px; margin: 16px 0; }
  .change-box .label { font-size: 12px; font-weight: 600; color: #B45309; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
  .change-arrow { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
  .change-from, .change-to { padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 500; }
  .change-from { background: #FEE2E2; color: #991B1B; text-decoration: line-through; }
  .change-to { background: #D1FAE5; color: #065F46; }

  .info-grid { display: grid; grid-template-columns: 100px 1fr; gap: 8px 16px; font-size: 14px; margin-top: 12px; }
  .info-grid dt { font-weight: 600; color: var(--text-secondary); }
  .info-grid dd { color: var(--text); }

  .purpose-list { display: grid; gap: 16px; margin-top: 8px; }
  .purpose-item { display: flex; gap: 14px; align-items: flex-start; }
  .purpose-num { width: 28px; height: 28px; border-radius: 50%; background: var(--accent-soft); color: var(--accent); font-size: 13px; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; }
  .purpose-item h4 { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
  .purpose-item p { font-size: 13px; color: var(--text-secondary); line-height: 1.65; }

  .method-options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
  .method-opt { background: var(--bg-warm); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 16px; }
  .method-opt h4 { font-size: 13px; font-weight: 600; color: var(--primary); margin-bottom: 6px; }
  .method-opt p { font-size: 12.5px; color: var(--text-secondary); line-height: 1.6; }

  .notice-footer { background: var(--bg-warm); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 20px 24px; margin-top: 16px; font-size: 13.5px; color: var(--text-secondary); line-height: 1.75; }
  .notice-footer strong { color: var(--text); }

  /* â”€â”€ Form â”€â”€ */
  .form-header { background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow-sm); padding: 24px 28px; margin-bottom: 20px; }
  .form-header h2 { font-size: 17px; font-weight: 700; color: var(--primary); margin-bottom: 4px; }
  .form-header p { font-size: 13px; color: var(--text-secondary); }

  .team-info-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
  .form-group { margin-bottom: 14px; }
  .form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 5px; }
  .form-group label .req { color: var(--danger); margin-left: 2px; }
  .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 9px 12px; border: 1px solid var(--border); border-radius: var(--radius-sm); font-family: inherit; font-size: 13px; color: var(--text); background: var(--surface); transition: border-color 0.2s; }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
  .form-group textarea { resize: vertical; min-height: 56px; }

  /* â”€â”€ Table â”€â”€ */
  .table-card { background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow-sm); overflow: hidden; margin-bottom: 20px; }
  .table-card-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-bottom: 1px solid var(--border); background: var(--bg-warm); flex-wrap: wrap; gap: 10px; }
  .table-card-header h3 { font-size: 14px; font-weight: 700; color: var(--primary); }

  .table-scroll { overflow-x: auto; }
  .expense-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .expense-table thead th { background: var(--primary); color: #fff; font-weight: 600; font-size: 11.5px; padding: 10px 8px; text-align: center; white-space: nowrap; }
  .expense-table tbody td { padding: 6px 4px; border-bottom: 1px solid var(--border-light); text-align: center; vertical-align: middle; font-size: 12.5px; }
  .expense-table tbody tr:hover { background: #F8FAFF; }
  .expense-table tbody td input, .expense-table tbody td select { width: 100%; padding: 6px 6px; border: 1px solid var(--border); border-radius: 6px; font-family: inherit; font-size: 12px; color: var(--text); background: #fff; text-align: center; }
  .expense-table tbody td input:focus, .expense-table tbody td select:focus { outline: none; border-color: var(--accent); }
  .expense-table tbody td input::placeholder { color: var(--text-muted); font-size: 10.5px; }

  .row-num { width: 26px; height: 26px; background: var(--accent-soft); color: var(--accent); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; }

  /* â”€â”€ Preview Table â”€â”€ */
  .preview-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .preview-table thead th { background: #334155; color: #fff; font-weight: 600; font-size: 11px; padding: 10px 8px; text-align: center; white-space: nowrap; }
  .preview-table tbody td { padding: 10px 8px; border-bottom: 1px solid var(--border-light); text-align: center; font-size: 12.5px; }
  .preview-table tbody tr:nth-child(even) { background: #FAFBFC; }
  .preview-table tbody tr:hover { background: #F0F4FF; }

  .card-chip { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11.5px; font-weight: 600; font-family: 'SF Mono','Fira Code',monospace; letter-spacing: 0.5px; background: #EEF2FF; color: #4338CA; }
  .badge-cycle { display: inline-block; padding: 2px 8px; border-radius: 20px; font-size: 11px; font-weight: 600; }
  .badge-monthly { background: #DBEAFE; color: #1D4ED8; }
  .badge-yearly { background: #E0E7FF; color: #4338CA; }

  .preview-meta { display: flex; gap: 20px; flex-wrap: wrap; padding: 14px 20px; background: var(--bg-warm); border-bottom: 1px solid var(--border); font-size: 13px; color: var(--text-secondary); }
  .preview-meta span strong { color: var(--text); font-weight: 600; }

  .preview-summary { display: flex; gap: 16px; padding: 14px 20px; background: linear-gradient(135deg,#EFF6FF,#F0F9FF); border-top: 1px solid var(--border); font-size: 13px; flex-wrap: wrap; }
  .summary-item { display: flex; align-items: center; gap: 8px; }
  .summary-item .s-label { color: var(--text-secondary); font-weight: 500; }
  .summary-item .s-value { color: var(--primary); font-weight: 700; font-size: 15px; }

  /* â”€â”€ Buttons â”€â”€ */
  .btn { padding: 8px 16px; border: none; border-radius: var(--radius-sm); font-family: inherit; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px; white-space: nowrap; }
  .btn-outline { background: var(--surface); color: var(--text-secondary); border: 1px solid var(--border); }
  .btn-outline:hover { background: var(--bg); color: var(--text); }
  .btn-danger { background: var(--danger-bg); color: var(--danger); border: 1px solid #FECACA; }
  .btn-danger:hover { background: #FEE2E2; }
  .btn-primary { background: var(--accent); color: #fff; box-shadow: 0 2px 6px rgba(59,130,246,0.25); }
  .btn-primary:hover { background: var(--accent-hover); }
  .btn-success { background: var(--success); color: #fff; box-shadow: 0 2px 6px rgba(16,185,129,0.25); }
  .btn-success:hover { background: #059669; }
  .btn-csv { background: #7C3AED; color: #fff; box-shadow: 0 2px 6px rgba(124,58,237,0.25); }
  .btn-csv:hover { background: #6D28D9; }
  .btn-lg { padding: 12px 24px; font-size: 14px; border-radius: var(--radius); }

  .submit-area { display: flex; justify-content: center; gap: 12px; margin-top: 24px; flex-wrap: wrap; }

  /* â”€â”€ Approval Table â”€â”€ */
  .approval-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 16px; }
  .approval-table th, .approval-table td { border: 1px solid #999; padding: 8px 12px; text-align: center; }
  .approval-table th { background: #F0F0F0; font-weight: 600; font-size: 12px; color: #333; }
  .approval-table .section-header { background: #1B2A4A; color: #fff; font-weight: 700; font-size: 13px; text-align: left; padding: 10px 16px; }
  .approval-table .cat-label { background: #F7F8FA; font-weight: 600; text-align: left; padding-left: 20px; }
  .approval-table .amount-cell { text-align: right; padding-right: 16px; font-weight: 600; }
  .approval-table .total-row { background: #EFF6FF; font-weight: 700; }
  .approval-table .total-row td { font-size: 14px; }

  .usage-list-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 8px; }
  .usage-list-table th { background: #334155; color: #fff; font-weight: 600; padding: 8px 6px; text-align: center; font-size: 11px; white-space: nowrap; }
  .usage-list-table td { border: 1px solid #DDD; padding: 6px 8px; text-align: center; font-size: 12px; }
  .usage-list-table tbody tr:nth-child(even) { background: #FAFBFC; }

  /* â”€â”€ Steps â”€â”€ */
  .steps { display: flex; gap: 0; margin-bottom: 20px; }
  .step { flex: 1; text-align: center; padding: 12px 8px; font-size: 12.5px; font-weight: 500; color: var(--text-muted); background: var(--bg-warm); border: 1px solid var(--border); }
  .step:first-child { border-radius: var(--radius-sm) 0 0 var(--radius-sm); }
  .step:last-child { border-radius: 0 var(--radius-sm) var(--radius-sm) 0; }
  .step.active { background: var(--accent); color: #fff; border-color: var(--accent); font-weight: 600; }
  .step.done { background: var(--success-bg); color: var(--success); border-color: #A7F3D0; }
  .step .step-num { display: block; font-size: 10px; font-weight: 700; margin-bottom: 2px; }

  .copy-notice { background: linear-gradient(135deg,#FFF7ED,#FFFBF0); border: 1px solid #FED7AA; border-left: 4px solid var(--warning); border-radius: 0 var(--radius-sm) var(--radius-sm) 0; padding: 12px 18px; margin: 12px 0; font-size: 13px; color: #92400E; }

  /* â”€â”€ Section Display â”€â”€ */
  .section { display: none; }
  .section.active { display: block; animation: fadeIn 0.3s ease; }
  @keyframes fadeIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }

  /* â”€â”€ Submitted Status â”€â”€ */
  .submitted-banner { display: flex; align-items: center; gap: 12px; padding: 16px 24px; background: var(--success-bg); border: 1px solid #A7F3D0; border-radius: var(--radius); margin-bottom: 20px; }
  .submitted-banner .check { width: 36px; height: 36px; background: var(--success); color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
  .submitted-banner .info { flex: 1; }
  .submitted-banner .info h4 { font-size: 14px; font-weight: 700; color: #065F46; margin-bottom: 2px; }
  .submitted-banner .info p { font-size: 12.5px; color: #047857; }

  /* â”€â”€ Team Status Cards â”€â”€ */
  .team-status-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px; }
  .team-status-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 16px; text-align: center; transition: all 0.2s; cursor: pointer; }
  .team-status-card:hover { border-color: var(--accent); box-shadow: var(--shadow-md); }
  .team-status-card.submitted { border-color: #A7F3D0; background: #F0FDF4; }
  .team-status-card.not-submitted { border-color: #FECACA; background: #FFF5F5; }
  .team-status-name { font-size: 14px; font-weight: 700; color: var(--primary); margin-bottom: 6px; }
  .team-status-badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
  .team-status-badge.done { background: #D1FAE5; color: #065F46; }
  .team-status-badge.pending { background: #FEE2E2; color: #991B1B; }
  .team-status-detail { font-size: 12px; color: var(--text-secondary); margin-top: 8px; }

  /* â”€â”€ Upload Zone â”€â”€ */
  .upload-zone { border: 2px dashed var(--border); border-radius: var(--radius); padding: 40px 24px; text-align: center; cursor: pointer; transition: all 0.3s; background: var(--bg-warm); }
  .upload-zone:hover, .upload-zone.drag-over { border-color: var(--accent); background: var(--accent-soft); }
  .upload-zone .upload-icon { font-size: 36px; margin-bottom: 10px; }
  .upload-zone p { font-size: 13px; color: var(--text-secondary); margin-bottom: 4px; }

  /* â”€â”€ Toast â”€â”€ */
  .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--primary); color: #fff; padding: 12px 24px; border-radius: var(--radius); font-size: 14px; font-weight: 500; box-shadow: 0 10px 40px rgba(0,0,0,0.2); z-index: 1000; transition: transform 0.4s cubic-bezier(0.16,1,0.3,1); }
  .toast.show { transform: translateX(-50%) translateY(0); }

  .footer { text-align: center; padding: 28px 24px; font-size: 12px; color: var(--text-muted); border-top: 1px solid var(--border); margin-top: 20px; }

  .example-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }

  /* â”€â”€ Team Chips â”€â”€ */
  .team-chips { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
  .team-chip { padding: 6px 14px; border-radius: 20px; border: 1px solid var(--border); background: var(--surface); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; color: var(--text-secondary); }
  .team-chip:hover { border-color: var(--accent); color: var(--accent); }
  .team-chip.active { background: var(--accent); color: #fff; border-color: var(--accent); }

  .approval-block { margin-bottom: 28px; }
  .approval-block-title { font-size: 16px; font-weight: 700; color: var(--primary); padding: 10px 0; margin-bottom: 8px; border-bottom: 2px solid var(--primary); }

  @media (max-width:640px) {
    .top-header { padding: 0 12px; height: auto; min-height: 48px; flex-wrap: wrap; gap: 6px; padding: 8px 12px; }
    .top-header h1 { font-size: 0.85rem; }
    .card { padding: 18px; }
    .team-info-row { grid-template-columns: 1fr; }
    .method-options { grid-template-columns: 1fr; }
    .mode-switch { flex-direction: column; }
    .steps { flex-direction: column; }
  }

  /* â”€â”€ Admin Password Modal â”€â”€ */
  .pw-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(4px); }
  .pw-modal { background: var(--surface); border-radius: var(--radius); padding: 36px 32px 28px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); text-align: center; max-width: 380px; width: 90%; }
  .pw-modal .pw-icon { width: 56px; height: 56px; border-radius: 50%; background: var(--accent-soft); display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; font-size: 24px; }
  .pw-modal h3 { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 6px; }
  .pw-modal p { font-size: 13px; color: var(--text-secondary); margin-bottom: 20px; }
  .pw-modal input { width: 100%; padding: 12px 16px; border: 1.5px solid var(--border); border-radius: var(--radius-sm); font-family: inherit; font-size: 14px; text-align: center; letter-spacing: 3px; transition: border-color 0.2s; }
  .pw-modal input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
  .pw-modal input.pw-error { border-color: var(--danger); animation: shake 0.4s; }
  .pw-modal .pw-msg { font-size: 12px; color: var(--danger); margin-top: 8px; min-height: 18px; }
  .pw-modal .pw-btns { display: flex; gap: 8px; margin-top: 16px; }
  .pw-modal .pw-btns button { flex: 1; padding: 10px; border: none; border-radius: var(--radius-sm); font-family: inherit; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
  .pw-modal .pw-cancel { background: var(--bg); color: var(--text-secondary); border: 1px solid var(--border); }
  .pw-modal .pw-cancel:hover { background: var(--border-light); }
  .pw-modal .pw-confirm { background: var(--accent); color: #fff; }
  .pw-modal .pw-confirm:hover { background: var(--accent-hover); }
  @keyframes shake { 0%,100%{transform:translateX(0)} 20%,60%{transform:translateX(-6px)} 40%,80%{transform:translateX(6px)} }

  /* â”€â”€ Change Password Message â”€â”€ */
  .cp-msg { font-size: 13px; min-height: 20px; padding: 0 2px; transition: all 0.2s; }
  .cp-msg.cp-error { color: var(--danger); }
  .cp-msg.cp-success { color: var(--success); }
</style>
</head>
<body>

<!-- â”€â”€ Admin Password Modal â”€â”€ -->
<div class="pw-overlay" id="pwOverlay" style="display:none;">
  <div class="pw-modal">
    <div class="pw-icon">ğŸ”’</div>
    <h3>ê´€ë¦¬ì ì¸ì¦</h3>
    <p>ì·¨í•© í˜ì´ì§€ëŠ” ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>
    <input type="password" id="pwInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" maxlength="20" autocomplete="off">
    <div class="pw-msg" id="pwMsg"></div>
    <div class="pw-btns">
      <button class="pw-cancel" onclick="closeAdminPw()">ì·¨ì†Œ</button>
      <button class="pw-confirm" onclick="verifyAdminPw()">í™•ì¸</button>
    </div>
  </div>
</div>

<!-- â”€â”€ Loading â”€â”€ -->
<div id="loadingOverlay" style="position:fixed;inset:0;background:rgba(241,245,249,.92);display:flex;align-items:center;justify-content:center;z-index:9999;flex-direction:column;gap:12px;">
  <div style="width:32px;height:32px;border:3px solid #E2E8F0;border-top-color:#3B82F6;border-radius:50%;animation:spin .7s linear infinite;"></div>
  <div style="color:#64748B;font-size:0.88rem;font-weight:500;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <style>@keyframes spin{to{transform:rotate(360deg)}}</style>
</div>

<!-- â”€â”€ Header â”€â”€ -->
<div class="top-header">
  <h1>ë²•ì¸ì¹´ë“œ ê³ ì •ì§€ì¶œ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
  <div class="hdr-right">
    <div class="sync-status" id="syncStatus">
      <div class="sync-dot online" id="syncDot"></div>
      <span id="syncText">ì‹¤ì‹œê°„ ì—°ê²°ë¨</span>
    </div>
    <button class="hdr-btn" onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
  </div>
</div>

<div class="container">

<!-- â”€â”€ Mode Switch â”€â”€ -->
<div class="mode-switch">
  <button class="mode-btn active" onclick="switchMode('notice')">ê³µì§€ ì‚¬í•­</button>
  <button class="mode-btn" onclick="switchMode('staff')">ì§ì› ëª¨ë“œ (íšŒì‹ )</button>
  <button class="mode-btn" onclick="switchMode('admin')">ê²½ì˜ê´€ë¦¬íŒ€ (ì·¨í•©)</button>
  <button class="mode-btn" onclick="switchMode('example')">ì‘ì„± ì˜ˆì‹œ</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODE: ê³µì§€ ì‚¬í•­               -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="mode-notice" class="section active">
  <div class="card">
    <div class="card-title"><div class="icon yellow">âš¡</div> ë³€ê²½ ì‚¬í•­</div>
    <div class="notice-text">ê° íŒ€ì—ì„œ ë°œìƒí•˜ëŠ” ë²•ì¸ì¹´ë“œ ì§€ì¶œ ê´€ë¦¬ì˜ <strong>íˆ¬ëª…ì„±ê³¼ íš¨ìœ¨ì„±</strong>ì„ ë†’ì´ê¸° ìœ„í•´, ê³ ì • ì§€ì¶œì— ëŒ€í•œ í’ˆì˜ì„œ ì‘ì„± ë°©ì‹ì„ ì•„ë˜ì™€ ê°™ì´ ë³€ê²½í•©ë‹ˆë‹¤.</div>
    <div class="change-box">
      <div class="label">í’ˆì˜ ì‘ì„± ë°©ì‹ ë³€ê²½</div>
      <div class="change-arrow">
        <span class="change-from">ìµœì´ˆ 1íšŒ í’ˆì˜</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M13 5l7 7-7 7"/></svg>
        <span class="change-to">ë§¤ì›” í’ˆì˜ì„œ ì‘ì„±</span>
      </div>
    </div>
    <dl class="info-grid">
      <dt>ëŒ€ìƒ</dt><dd>ê° íŒ€ë³„ ë²•ì¸ì¹´ë“œ ì¥ê¸°(ê³ ì •) ì§€ì¶œ ê±´</dd>
      <dt>ì‹œí–‰ì¼</dt><dd><strong>2026ë…„ 2ì›” ì§€ì¶œë¶„</strong>ë¶€í„°</dd>
    </dl>
  </div>
  <div class="card">
    <div class="card-title"><div class="icon blue">ğŸ¯</div> í’ˆì˜ì„œ ì‘ì„± ëª©ì </div>
    <div class="notice-text" style="margin-bottom:14px;">ë‹¨ìˆœí•œ ì ˆì°¨ ì¶”ê°€ê°€ ì•„ë‹Œ, <strong>íˆ¬ëª…í•œ ë¹„ìš© ê´€ë¦¬ì™€ íš¨ìœ¨ì ì¸ ì˜ˆì‚° ìš´ì˜</strong>ì„ ìœ„í•´ ì‹œí–‰í•©ë‹ˆë‹¤.</div>
    <div class="purpose-list">
      <div class="purpose-item"><div class="purpose-num">1</div><div><h4>ì§€ì¶œ í˜„í™© ì¸ì§€ ë° ê³µë°± ë°©ì§€</h4><p>ìë™ ê²°ì œ íŠ¹ì„±ìƒ ë‹´ë‹¹ì ë¶€ì¬ ì‹œ ì§€ì¶œ ë‚´ì—­ íŒŒì•…ì´ ì–´ë ¤ìš´ ì ì„ ë³´ì™„í•©ë‹ˆë‹¤.</p></div></div>
      <div class="purpose-item"><div class="purpose-num">2</div><div><h4>ë¹„ìš© ë¶„ì„ ë° ì„ ì œì  í†µì œ</h4><p>ì›”ë³„ ì‚¬ìš© ê¸ˆì•¡ì„ íŒŒì•…í•˜ì—¬ ë¶ˆí•„ìš”í•œ ê³ ì • ì§€ì¶œì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.</p></div></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title"><div class="icon green">ğŸ“</div> ì‘ì„± ë°©ë²• ë° ì‹œì </div>
    <div class="notice-text" style="margin-bottom:12px;">ì‘ì„± ì‹œì ì€ íŒ€ë³„ ìƒí™©ì— ë§ì¶° <strong>ìœ ì—°í•˜ê²Œ ì„ íƒ</strong>í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    <div class="method-options">
      <div class="method-opt"><h4>ê°œë³„ ì‘ì„±</h4><p>í•´ë‹¹ ì¹´ë“œ ì§€ì¶œ ì‹œì ì— ë§ì¶° ê±´ë³„ë¡œ ì¦‰ì‹œ ì‘ì„±</p></div>
      <div class="method-opt"><h4>ì›”ë³„ í†µí•© ì‘ì„±</h4><p>ì›”ì´ˆ ë˜ëŠ” íŠ¹ì •ì¼ì„ ì§€ì •í•˜ì—¬ í•œ ë‹¬ ì¹˜ í†µí•© ì‘ì„±</p></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title"><div class="icon red">ğŸ¤</div> í˜‘ì¡° ìš”ì²­ ì‚¬í•­</div>
    <div class="notice-footer">ë²•ì¸ì¹´ë“œëŠ” íšŒì‚¬ì˜ ì†Œì¤‘í•œ ìì‚°ì¸ ë§Œí¼, ê° <strong>íŒ€ì¥ë‹˜ê³¼ ë‹´ë‹¹ì</strong>ë¶„ë“¤ê»˜ì„œëŠ” ë¹„ìš©ì´ ì–´ë””ì—, ì–¼ë§ˆë‚˜ ì§€ì¶œë˜ê³  ìˆëŠ”ì§€ ì ê²€í•´ ì£¼ì‹œëŠ” ê³„ê¸°ê°€ ë˜ê¸¸ ë°”ëë‹ˆë‹¤.<br><br>ê¶ê¸ˆí•˜ì‹  ì ì€ <strong>ê²½ì˜ê´€ë¦¬íŒ€</strong>ìœ¼ë¡œ ì—°ë½í•´ ì£¼ì„¸ìš”.</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODE: ì§ì› ëª¨ë“œ (íšŒì‹ )         -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="mode-staff" class="section">

  <!-- Team Selector -->
  <div class="team-selector">
    <div class="team-selector-title">ğŸ‘¤ ë³¸ì¸ íŒ€ì„ ì„ íƒí•˜ì„¸ìš”</div>
    <div class="team-tabs" id="teamTabs"></div>
    <div class="quick-join">
      <span style="font-size:12px;color:var(--text-muted);">íŒ€ì´ ì—†ìœ¼ì‹ ê°€ìš”?</span>
      <input type="text" id="newTeamInput" placeholder="ìƒˆ íŒ€ëª… ì…ë ¥">
      <button class="btn btn-primary" style="padding:6px 14px;font-size:12px;" onclick="addNewTeam()">íŒ€ ì¶”ê°€</button>
    </div>
  </div>

  <!-- Submitted Banner (shown if already submitted) -->
  <div id="submittedBanner" style="display:none;"></div>

  <!-- Staff Sub-tabs -->
  <div class="sub-tabs">
    <button class="sub-tab active" onclick="switchStaffTab('input')">ë‚´ì—­ ì…ë ¥</button>
    <button class="sub-tab" onclick="switchStaffTab('staffApproval')">í’ˆì˜ì„œ ì–‘ì‹ ë³€í™˜</button>
  </div>

  <!-- INPUT Tab -->
  <div id="staffInput" class="section active">
    <div class="form-header">
      <h2>ê³ ì • ì§€ì¶œ ë‚´ì—­ ì‘ì„±</h2>
      <p>ì•„ë˜ ì–‘ì‹ì— íŒ€ì˜ ê³ ì • ì§€ì¶œ ë‚´ì—­ì„ ì‘ì„± í›„ ì €ì¥í•´ ì£¼ì„¸ìš”. ì €ì¥ ì¦‰ì‹œ ê²½ì˜ê´€ë¦¬íŒ€ì— ê³µìœ ë©ë‹ˆë‹¤.</p>
    </div>

    <div class="card">
      <div class="card-title"><div class="icon blue">ğŸ“‹</div> ê¸°ë³¸ ì •ë³´</div>
      <div class="team-info-row">
        <div class="form-group">
          <label>ì‘ì„±ì <span class="req">*</span></label>
          <input type="text" id="staffWriter" placeholder="ì´ë¦„ ì…ë ¥">
        </div>
        <div class="form-group">
          <label>í•´ë‹¹ ì›” <span class="req">*</span></label>
          <input type="text" id="staffMonth" placeholder="ì˜ˆ: 202601" maxlength="7" style="font-variant-numeric:tabular-nums;">
          <span id="staffMonthPreview" style="font-size:12px;color:var(--accent);margin-top:4px;display:block;min-height:18px;"></span>
        </div>
      </div>
    </div>

    <!-- Monthly -->
    <div class="table-card">
      <div class="table-card-header">
        <h3>ì›” ê²°ì œ ì„œë¹„ìŠ¤</h3>
        <button class="btn btn-outline" onclick="addStaffRow('monthly')">+ í–‰ ì¶”ê°€</button>
      </div>
      <div class="table-scroll">
        <table class="expense-table" id="staffMonthlyTable">
          <thead><tr>
            <th style="width:36px">No.</th>
            <th style="min-width:80px">ì„œë¹„ìŠ¤ëª…</th>
            <th style="min-width:80px">ê³µê¸‰ì—…ì²´</th>
            <th style="min-width:100px">êµ¬ë§¤ ëª©ì </th>
            <th style="min-width:80px">ì´ìš© í”Œëœ</th>
            <th style="min-width:80px">ì›” ê¸ˆì•¡</th>
            <th style="min-width:60px">ê²°ì œì£¼ê¸°</th>
            <th style="min-width:70px">ì •ê¸°ê²°ì œì¼</th>
            <th style="min-width:80px">ì‚¬ìš© ë¶€ì„œ</th>
            <th style="min-width:110px">ì‚¬ìš© ê³„ì •</th>
            <th style="min-width:70px">ê²°ì œì¹´ë“œ<br>(ë4ìë¦¬)</th>
            <th style="min-width:60px">ë¹„ê³ </th>
            <th style="width:36px"></th>
          </tr></thead>
          <tbody id="staffMonthlyBody">
            <tr>
              <td><span class="row-num">1</span></td>
              <td><input type="text" placeholder="ì„œë¹„ìŠ¤ëª…"></td>
              <td><input type="text" placeholder="ê³µê¸‰ì—…ì²´"></td>
              <td><input type="text" placeholder="êµ¬ë§¤ ëª©ì "></td>
              <td><input type="text" placeholder="í”Œëœëª…"></td>
              <td><input type="text" placeholder="ê¸ˆì•¡"></td>
              <td><select><option>ì›”ë³„</option></select></td>
              <td><input type="text" placeholder="ë§¤ì›” Nì¼"></td>
              <td><input type="text" placeholder="ë¶€ì„œ"></td>
              <td><input type="text" placeholder="ì´ë©”ì¼"></td>
              <td><input type="text" placeholder="0000"></td>
              <td><input type="text" placeholder="-"></td>
              <td><button class="btn btn-danger" onclick="removeStaffRow(this)" style="padding:4px 7px;font-size:10px;">âœ•</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Yearly -->
    <div class="table-card">
      <div class="table-card-header">
        <h3>ì—° ê²°ì œ ì„œë¹„ìŠ¤</h3>
        <button class="btn btn-outline" onclick="addStaffRow('yearly')">+ í–‰ ì¶”ê°€</button>
      </div>
      <div class="table-scroll">
        <table class="expense-table" id="staffYearlyTable">
          <thead><tr>
            <th style="width:36px">No.</th>
            <th style="min-width:80px">ì„œë¹„ìŠ¤ëª…</th>
            <th style="min-width:80px">ê³µê¸‰ì—…ì²´</th>
            <th style="min-width:100px">êµ¬ë§¤ ëª©ì </th>
            <th style="min-width:80px">ì´ìš© í”Œëœ</th>
            <th style="min-width:80px">ì—° ê¸ˆì•¡</th>
            <th style="min-width:60px">ê²°ì œì£¼ê¸°</th>
            <th style="min-width:90px">ê¸°ê°„</th>
            <th style="min-width:70px">ê°±ì‹ ì¼</th>
            <th style="min-width:80px">ì‚¬ìš© ë¶€ì„œ</th>
            <th style="min-width:110px">ì‚¬ìš© ê³„ì •</th>
            <th style="min-width:70px">ê²°ì œì¹´ë“œ<br>(ë4ìë¦¬)</th>
            <th style="min-width:60px">ë¹„ê³ </th>
            <th style="width:36px"></th>
          </tr></thead>
          <tbody id="staffYearlyBody">
            <tr>
              <td><span class="row-num">1</span></td>
              <td><input type="text" placeholder="ì„œë¹„ìŠ¤ëª…"></td>
              <td><input type="text" placeholder="ê³µê¸‰ì—…ì²´"></td>
              <td><input type="text" placeholder="êµ¬ë§¤ ëª©ì "></td>
              <td><input type="text" placeholder="í”Œëœëª…"></td>
              <td><input type="text" placeholder="ê¸ˆì•¡"></td>
              <td><select><option>ì—°ê°„</option></select></td>
              <td><input type="text" placeholder="ì‹œì‘~ì¢…ë£Œ"></td>
              <td><input type="text" placeholder="ê°±ì‹ ì¼"></td>
              <td><input type="text" placeholder="ë¶€ì„œ"></td>
              <td><input type="text" placeholder="ì´ë©”ì¼"></td>
              <td><input type="text" placeholder="0000"></td>
              <td><input type="text" placeholder="-"></td>
              <td><button class="btn btn-danger" onclick="removeStaffRow(this)" style="padding:4px 7px;font-size:10px;">âœ•</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <div class="form-group">
        <label>ì¶”ê°€ ì „ë‹¬ ì‚¬í•­ (ì„ íƒ)</label>
        <textarea id="staffNote" placeholder="ê²½ì˜ê´€ë¦¬íŒ€ì— ì¶”ê°€ë¡œ ì „ë‹¬í•  ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì‘ì„±í•´ ì£¼ì„¸ìš”."></textarea>
      </div>
    </div>

    <div class="submit-area">
      <button class="btn btn-outline btn-lg" onclick="resetStaffForm()">ì´ˆê¸°í™”</button>
      <button class="btn btn-csv btn-lg" onclick="downloadMyTeamCSV()" style="display:flex;align-items:center;gap:6px;">ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</button>
      <button class="btn btn-primary btn-lg" onclick="saveToFirebase()">ğŸ’¾ ì €ì¥ (ì‹¤ì‹œê°„ ê³µìœ )</button>
    </div>
  </div>

  <!-- STAFF: í’ˆì˜ì„œ ì–‘ì‹ ë³€í™˜ Tab -->
  <div id="staffApproval" class="section">
    <div class="copy-notice">
      <strong>ì‚¬ìš© ë°©ë²•:</strong> ì•„ë˜ ìƒì„±ëœ í…Œì´ë¸”ì„ <strong>Ctrl+C</strong>ë¡œ ë³µì‚¬ â†’ í•˜ì´ì›ìŠ¤ í’ˆì˜ì„œ ë³¸ë¬¸ <strong>[ - ì•„ ë˜ - ]</strong> ì•„ë˜ì— <strong>Ctrl+V</strong>ë¡œ ë¶™ì—¬ë„£ê¸°
    </div>
    <div class="card">
      <div class="card-title"><div class="icon purple">ğŸ¢</div> í’ˆì˜ì„œ ê¸°ë³¸ ì„¤ì •</div>
      <div class="team-info-row">
        <div class="form-group">
          <label>ì†Œì† íŒ€</label>
          <div id="staffApprovalTeamDisplay" style="padding:9px 14px;background:var(--bg-warm);border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:14px;font-weight:600;color:var(--primary);min-height:40px;display:flex;align-items:center;">íŒ€ ë¯¸ì„ íƒ</div>
        </div>
        <div class="form-group">
          <label>ì´ìš©ì(ì‚¬ìš©ì)</label>
          <div id="staffApprovalUserDisplay" style="padding:9px 14px;background:var(--bg-warm);border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:14px;font-weight:500;color:var(--text);min-height:40px;display:flex;align-items:center;">-</div>
        </div>
        <div class="form-group">
          <label>ì¹´ë“œì‚¬ìš©ê¸°ê°„</label>
          <div style="display:flex;gap:8px;align-items:center;">
            <input type="date" id="staffApprovalStart">
            <span>~</span>
            <input type="date" id="staffApprovalEnd">
          </div>
        </div>
      </div>
    </div>
    <div id="staffApprovalFormsArea"></div>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODE: ê²½ì˜ê´€ë¦¬íŒ€ (ì·¨í•©)        -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="mode-admin" class="section">
  <div class="form-header">
    <h2>ê²½ì˜ê´€ë¦¬íŒ€ â€” ê³ ì • ì§€ì¶œ ì·¨í•© ë° í’ˆì˜ì„œ ë³€í™˜</h2>
    <p>ê° íŒ€ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ì…ë ¥í•œ ê³ ì • ì§€ì¶œ ë‚´ì—­ì„ í™•ì¸í•˜ê³ , í•˜ì´ì›ìŠ¤ í’ˆì˜ì„œ ì–‘ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
  </div>

  <!-- Team Status Overview -->
  <div class="card">
    <div class="card-title"><div class="icon green">ğŸ“Š</div> íŒ€ë³„ ì œì¶œ í˜„í™©</div>
    <div class="team-status-grid" id="teamStatusGrid"></div>
  </div>

  <!-- Sub-tabs -->
  <div class="sub-tabs">
    <button class="sub-tab active" onclick="switchAdminTab('overview')">íŒ€ë³„ ìƒì„¸ í™•ì¸</button>
    <button class="sub-tab" onclick="switchAdminTab('allOverview')">ì „ì²´ ìƒì„¸ í™•ì¸</button>
    <button class="sub-tab" onclick="switchAdminTab('changePw')" style="margin-left:auto;">ğŸ”’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
  </div>

  <!-- Overview: íŒ€ë³„ ìƒì„¸ í™•ì¸ -->
  <div id="adminOverview" class="section active">
    <div class="team-chips" id="adminTeamChips"></div>
    <div id="adminTeamDetail"></div>
  </div>

  <!-- Overview: ì „ì²´ ìƒì„¸ í™•ì¸ -->
  <div id="adminAllOverview" class="section">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <div style="font-size:15px;font-weight:700;color:var(--primary);">ğŸ“‹ ì „ì²´ íŒ€ ê³ ì • ì§€ì¶œ ë‚´ì—­</div>
      <button class="btn btn-csv btn-lg" onclick="downloadAllCSV()" style="display:flex;align-items:center;gap:6px;">ğŸ“¥ ì „ì²´ CSV ë‹¤ìš´ë¡œë“œ</button>
    </div>
    <div id="adminAllDetail"></div>
  </div>

  <!-- Change Password -->
  <div id="adminChangePw" class="section">
    <div class="card" style="max-width:460px;">
      <div class="card-title"><div class="icon red">ğŸ”’</div> ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
      <p style="font-size:13px;color:var(--text-secondary);margin-bottom:20px;">ì·¨í•© í˜ì´ì§€ ì ‘ê·¼ìš© ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.</p>
      <div style="display:flex;flex-direction:column;gap:14px;">
        <div class="form-group">
          <label style="font-size:13px;font-weight:600;color:var(--text-secondary);margin-bottom:4px;display:block;">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" id="cpCurrent" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" autocomplete="off" style="width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-family:inherit;font-size:14px;">
        </div>
        <div class="form-group">
          <label style="font-size:13px;font-weight:600;color:var(--text-secondary);margin-bottom:4px;display:block;">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" id="cpNew" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (4ì ì´ìƒ)" autocomplete="off" style="width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-family:inherit;font-size:14px;">
        </div>
        <div class="form-group">
          <label style="font-size:13px;font-weight:600;color:var(--text-secondary);margin-bottom:4px;display:block;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" id="cpConfirm" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥" autocomplete="off" style="width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-family:inherit;font-size:14px;">
        </div>
        <div id="cpMsg" class="cp-msg"></div>
        <button class="btn btn-primary btn-lg" onclick="changeAdminPw()" style="width:100%;justify-content:center;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MODE: ì‘ì„± ì˜ˆì‹œ              -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="mode-example" class="section">
  <div class="form-header">
    <h2>ë³„ë„ ì‘ì„± ì˜ˆì‹œë³¸</h2>
    <p>ì•„ë˜ëŠ” ê³ ì • ì§€ì¶œ ë‚´ì—­ íšŒì‹  ì–‘ì‹ì˜ ì‘ì„± ì˜ˆì‹œì…ë‹ˆë‹¤. ì‹¤ì œ íŒ€ ì •ë³´ë¥¼ ë°˜ì˜í•˜ì—¬ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”.</p>
  </div>
  <div class="table-card">
    <div class="table-card-header"><h3>ê¸°ë³¸ ì •ë³´ (ì˜ˆì‹œ)</h3></div>
    <div class="preview-meta">
      <span>íŒ€ëª…: <strong>OOíŒ€</strong></span>
      <span>ì‘ì„±ì: <strong>í™ê¸¸ë™</strong></span>
      <span>ì‘ì„±ì¼: <strong>2026-02-13</strong></span>
      <span>í•´ë‹¹ ì›”: <strong>2026ë…„ 2ì›”</strong></span>
    </div>
  </div>
  <div class="table-card">
    <div class="table-card-header"><h3>ì›” ê²°ì œ ì„œë¹„ìŠ¤ (ì˜ˆì‹œ)</h3><span class="example-badge badge-monthly">ì›”ë³„ ê²°ì œ</span></div>
    <div class="table-scroll">
      <table class="preview-table"><thead><tr><th>No.</th><th>ì„œë¹„ìŠ¤ëª…</th><th>ê³µê¸‰ì—…ì²´</th><th>êµ¬ë§¤ ëª©ì </th><th>ì´ìš© í”Œëœ</th><th>ì›” ê¸ˆì•¡</th><th>ê²°ì œì£¼ê¸°</th><th>ì •ê¸°ê²°ì œì¼</th><th>ì‚¬ìš© ë¶€ì„œ</th><th>ì‚¬ìš© ê³„ì •</th><th>ê²°ì œì¹´ë“œ</th></tr></thead>
      <tbody>
        <tr><td><span class="row-num">1</span></td><td><strong>SaaS ì„œë¹„ìŠ¤A</strong></td><td>Aì‚¬</td><td>ì—…ë¬´ ìƒì‚°ì„± í–¥ìƒ</td><td>Standard</td><td><strong>USD 20</strong></td><td><span class="badge-cycle badge-monthly">ì›”ë³„</span></td><td>ë§¤ì›” 15ì¼</td><td>OOíŒ€</td><td style="font-size:11px">example@company.com</td><td><span class="card-chip">0000</span></td></tr>
        <tr><td><span class="row-num">2</span></td><td><strong>í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤B</strong></td><td>Bì‚¬</td><td>ë°ì´í„° ë¶„ì„</td><td>Pro</td><td><strong>55,000ì›</strong></td><td><span class="badge-cycle badge-monthly">ì›”ë³„</span></td><td>ë§¤ì›” 1ì¼</td><td>OOíŒ€</td><td style="font-size:11px">team@company.com</td><td><span class="card-chip">1234</span></td></tr>
      </tbody></table>
    </div>
  </div>
  <div class="table-card">
    <div class="table-card-header"><h3>ì—° ê²°ì œ ì„œë¹„ìŠ¤ (ì˜ˆì‹œ)</h3><span class="example-badge badge-yearly">ì—°ê°„ ê²°ì œ</span></div>
    <div class="table-scroll">
      <table class="preview-table"><thead><tr><th>No.</th><th>ì„œë¹„ìŠ¤ëª…</th><th>ê³µê¸‰ì—…ì²´</th><th>êµ¬ë§¤ ëª©ì </th><th>ì´ìš© í”Œëœ</th><th>ì—° ê¸ˆì•¡</th><th>ê²°ì œì£¼ê¸°</th><th>ê¸°ê°„</th><th>ê°±ì‹ ì¼</th><th>ì‚¬ìš© ë¶€ì„œ</th><th>ì‚¬ìš© ê³„ì •</th><th>ê²°ì œì¹´ë“œ</th></tr></thead>
      <tbody>
        <tr><td><span class="row-num">1</span></td><td><strong>ë””ìì¸ íˆ´C</strong></td><td>Cì‚¬</td><td>ë§ˆì¼€íŒ… ìë£Œ ì œì‘</td><td>Business</td><td><strong>129,000ì›</strong></td><td><span class="badge-cycle badge-yearly">ì—°ê°„</span></td><td>2026-01-01~2026-12-31</td><td>2027-01-01</td><td>OOíŒ€</td><td style="font-size:11px">team@company.com</td><td><span class="card-chip">5678</span></td></tr>
      </tbody></table>
    </div>
    <div class="preview-summary">
      <div class="summary-item"><span class="s-label">ì›” ê²°ì œ ì´</span><span class="s-value">2ê±´</span></div>
      <div class="summary-item"><span class="s-label">ì—° ê²°ì œ ì´</span><span class="s-value">1ê±´</span></div>
    </div>
  </div>
  <div class="card" style="text-align:center;padding:20px;">
    <p style="font-size:14px;color:var(--text-secondary);">ìœ„ ì˜ˆì‹œë¥¼ ì°¸ê³ í•˜ì—¬ <strong style="color:var(--accent);cursor:pointer;" onclick="switchMode('staff')">ì§ì› ëª¨ë“œ (íšŒì‹ )</strong> ì—ì„œ ì‘ì„±í•´ ì£¼ì„¸ìš”.</p>
  </div>
</div>

</div><!-- container -->

<div class="footer">ê²½ì˜ê´€ë¦¬íŒ€ Â· ë¬¸ì˜ì‚¬í•­ì€ ê²½ì˜ê´€ë¦¬íŒ€ìœ¼ë¡œ ì—°ë½ ë°”ëë‹ˆë‹¤</div>
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Firebase ì´ˆê¸°í™” (ì—°ì°¨ ì‹œìŠ¤í…œê³¼ ë™ì¼ ì¸ìŠ¤í„´ìŠ¤)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FB_CONFIG = {
  apiKey: "AIzaSyCzngaCcenhH1tmZ7syugpI3H1wYBVhiJQ",
  authDomain: "test-168a4.firebaseapp.com",
  databaseURL: "https://test-168a4-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "test-168a4",
  storageBucket: "test-168a4.firebasestorage.app",
  messagingSenderId: "955362696992",
  appId: "1:955362696992:web:234b098db17412be27c145"
};

// ê°™ì€ í˜ì´ì§€ì—ì„œ ì—°ì°¨ ì‹œìŠ¤í…œê³¼ ë¶„ë¦¬
let fbApp;
try { fbApp = firebase.app(); } catch(e) { fbApp = firebase.initializeApp(FB_CONFIG); }
const fbDb = firebase.database();
const DB_ROOT = '/corp_card_fixed'; // ë²•ì¸ì¹´ë“œ ê³ ì •ì§€ì¶œ ì „ìš© ê²½ë¡œ

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  State
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentTeam = null;
let allTeamsData = {}; // { teamName: { meta, monthly, yearly, submittedAt } }
let isSaving = false;
let adminUnlocked = false; // ê´€ë¦¬ì ì¸ì¦ ìƒíƒœ
let adminPw = 'netform2026'; // ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ (Firebaseì—ì„œ ë®ì–´ì”€)
const PW_DB_PATH = '/corp_card_fixed_settings/adminPassword';

// Firebaseì—ì„œ ë¹„ë°€ë²ˆí˜¸ ë¡œë“œ
function loadAdminPw() {
  fbDb.ref(PW_DB_PATH).once('value').then(snap => {
    if (snap.val()) adminPw = snap.val();
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Admin Password
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showAdminPw() {
  document.getElementById('pwOverlay').style.display = 'flex';
  const inp = document.getElementById('pwInput');
  inp.value = '';
  document.getElementById('pwMsg').textContent = '';
  inp.classList.remove('pw-error');
  setTimeout(() => inp.focus(), 100);
}
function closeAdminPw() {
  document.getElementById('pwOverlay').style.display = 'none';
}
function verifyAdminPw() {
  const inp = document.getElementById('pwInput');
  if (inp.value === adminPw) {
    adminUnlocked = true;
    closeAdminPw();
    switchMode('admin');
  } else {
    inp.classList.add('pw-error');
    document.getElementById('pwMsg').textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
    inp.value = '';
    setTimeout(() => inp.classList.remove('pw-error'), 400);
  }
}

// ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
function changeAdminPw() {
  const curPw = document.getElementById('cpCurrent').value;
  const newPw = document.getElementById('cpNew').value;
  const confirmPw = document.getElementById('cpConfirm').value;
  const msgEl = document.getElementById('cpMsg');

  msgEl.className = 'cp-msg';
  if (!curPw || !newPw || !confirmPw) { msgEl.textContent = 'ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.'; msgEl.classList.add('cp-error'); return; }
  if (curPw !== adminPw) { msgEl.textContent = 'í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'; msgEl.classList.add('cp-error'); return; }
  if (newPw.length < 4) { msgEl.textContent = 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'; msgEl.classList.add('cp-error'); return; }
  if (newPw !== confirmPw) { msgEl.textContent = 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'; msgEl.classList.add('cp-error'); return; }
  if (curPw === newPw) { msgEl.textContent = 'í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ì™€ ë‹¤ë¥¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.'; msgEl.classList.add('cp-error'); return; }

  fbDb.ref(PW_DB_PATH).set(newPw).then(() => {
    adminPw = newPw;
    document.getElementById('cpCurrent').value = '';
    document.getElementById('cpNew').value = '';
    document.getElementById('cpConfirm').value = '';
    msgEl.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.';
    msgEl.classList.add('cp-success');
  }).catch(err => {
    msgEl.textContent = 'ì €ì¥ ì˜¤ë¥˜: ' + err.message;
    msgEl.classList.add('cp-error');
  });
}

// Enter í‚¤ë¡œ í™•ì¸
document.addEventListener('DOMContentLoaded', () => {
  const pwInp = document.getElementById('pwInput');
  if (pwInp) pwInp.addEventListener('keydown', e => { if (e.key === 'Enter') verifyAdminPw(); });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Mode Switch
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchMode(mode) {
  if (mode === 'admin' && !adminUnlocked) { showAdminPw(); return; }
  const modes = ['notice','staff','admin','example'];
  document.querySelectorAll('.mode-btn').forEach((b, i) => b.classList.toggle('active', modes[i] === mode));
  modes.forEach(m => {
    const el = document.getElementById('mode-' + m);
    if (el) { el.classList.toggle('active', m === mode); }
  });
  if (mode === 'admin') renderAdminView();
  if (mode === 'staff' && currentTeam) loadTeamDataToForm();
}

function switchStaffTab(tab) {
  const tabMap = ['input','staffApproval'];
  document.querySelectorAll('#mode-staff .sub-tab').forEach((b, i) => b.classList.toggle('active', tabMap[i] === tab));
  ['staffInput','staffApproval'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.toggle('active', id === (tab === 'input' ? 'staffInput' : tab));
  });
  if (tab === 'staffApproval') renderStaffApprovalForm();
}

function switchAdminTab(tab) {
  const tabs = ['overview','allOverview','changePw'];
  document.querySelectorAll('#mode-admin .sub-tab').forEach((b, i) => b.classList.toggle('active', tabs[i] === tab));
  tabs.forEach(t => {
    const el = document.getElementById('admin' + t.charAt(0).toUpperCase() + t.slice(1));
    if (el) el.classList.toggle('active', t === tab);
  });
  if (tab === 'allOverview') renderAdminAllDetail();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Firebase Realtime Sync
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initFirebase() {
  loadAdminPw(); // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë¡œë“œ
  // Listen for all team data changes
  fbDb.ref(DB_ROOT).on('value', snapshot => {
    if (isSaving) return;
    const data = snapshot.val();
    allTeamsData = data || {};
    renderTeamTabs();
    renderTeamStatusForAdmin();
    // If on staff mode and team selected, check if data changed
    if (currentTeam && allTeamsData[currentTeam]) {
      updateSubmittedBanner();
    }
    // Hide loading
    const lo = document.getElementById('loadingOverlay');
    if (lo) lo.style.display = 'none';
  });

  // Connection status
  fbDb.ref('.info/connected').on('value', snap => {
    const dot = document.getElementById('syncDot');
    const txt = document.getElementById('syncText');
    if (snap.val()) {
      dot.className = 'sync-dot online';
      txt.textContent = 'ì‹¤ì‹œê°„ ì—°ê²°ë¨';
    } else {
      dot.className = 'sync-dot offline';
      txt.textContent = 'ì˜¤í”„ë¼ì¸';
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Team Management
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTeamTabs() {
  const container = document.getElementById('teamTabs');
  const teams = Object.keys(allTeamsData);

  // Restore last selected team from localStorage
  const savedTeam = localStorage.getItem('cc_fixed_team');
  if (savedTeam && allTeamsData[savedTeam]) {
    currentTeam = savedTeam;
  } else if (!currentTeam && teams.length > 0) {
    currentTeam = null; // íŒ€ ë¯¸ì„ íƒ ìƒíƒœë¡œ ì‹œì‘
  }

  const teamColors = ['#3b82f6','#10b981','#ec4899','#f59e0b','#8b5cf6','#06b6d4','#f97316','#22c55e','#a855f7','#f43f5e'];

  // ì´ë¯¸ íŒ€ì´ ì„ íƒ(ì ê¸ˆ)ëœ ê²½ìš°: ë³¸ì¸ íŒ€ë§Œ í‘œì‹œ + íŒ€ ë³€ê²½ ë²„íŠ¼
  if (currentTeam) {
    const i = teams.indexOf(currentTeam);
    const color = teamColors[(i >= 0 ? i : 0) % teamColors.length];
    container.innerHTML = `<div class="team-tab active" style="cursor:default;">
        <div class="team-dot" style="background:${color}"></div>
        <span>${currentTeam}</span>
      </div>
      <button class="btn btn-outline" onclick="unlockTeam()" style="font-size:11px;padding:5px 14px;margin-left:8px;">íŒ€ ë³€ê²½</button>`;
  } else {
    // íŒ€ ë¯¸ì„ íƒ: ì „ì²´ íŒ€ ëª©ë¡ í‘œì‹œ (ê±´ìˆ˜ ë¯¸í‘œì‹œ â€” íƒ€ íŒ€ ì •ë³´ ë³´í˜¸)
    container.innerHTML = teams.map((t, i) => {
      const color = teamColors[i % teamColors.length];
      return `<div class="team-tab" onclick="selectTeam('${t}')">
        <div class="team-dot" style="background:${color}"></div>
        <span>${t}</span>
      </div>`;
    }).join('');
  }
}

function selectTeam(teamName) {
  currentTeam = teamName;
  localStorage.setItem('cc_fixed_team', teamName);
  renderTeamTabs();
  loadTeamDataToForm();
  updateSubmittedBanner();
}

function unlockTeam() {
  if (!confirm('ë‹¤ë¥¸ íŒ€ìœ¼ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(í˜„ì¬ ì…ë ¥ ì¤‘ì¸ ë‚´ìš©ì€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)')) return;
  currentTeam = null;
  localStorage.removeItem('cc_fixed_team');
  renderTeamTabs();
  // í¼ ì´ˆê¸°í™”
  ['staffWriter','staffMonth','staffNote'].forEach(id => document.getElementById(id).value = '');
  ['staffMonthlyBody','staffYearlyBody'].forEach(id => {
    const tbody = document.getElementById(id);
    tbody.innerHTML = '';
    addStaffRowWithData(id.includes('Monthly') ? 'monthly' : 'yearly', {}, 1);
  });
  document.getElementById('submittedBanner').style.display = 'none';
}

function addNewTeam() {
  const input = document.getElementById('newTeamInput');
  const name = input.value.trim();
  if (!name) { showToast('íŒ€ëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }
  if (allTeamsData[name]) {
    selectTeam(name);
    input.value = '';
    showToast(name + ' íŒ€ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.');
    return;
  }
  // Create empty team in Firebase
  isSaving = true;
  fbDb.ref(DB_ROOT + '/' + name).set({
    meta: { team: name, writer: '', month: '', submittedAt: '' },
    monthly: {},
    yearly: {}
  }).then(() => {
    isSaving = false;
    selectTeam(name);
    input.value = '';
    showToast(name + ' íŒ€ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
  }).catch(err => {
    isSaving = false;
    showToast('ì˜¤ë¥˜: ' + err.message);
  });
}

document.getElementById('newTeamInput').addEventListener('keypress', e => { if (e.key === 'Enter') addNewTeam(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Staff: Load/Save
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadTeamDataToForm() {
  if (!currentTeam || !allTeamsData[currentTeam]) return;
  const data = allTeamsData[currentTeam];

  // Meta
  if (data.meta) {
    document.getElementById('staffWriter').value = data.meta.writer || '';
    const rawMonth = (data.meta.month || '').replace(/-/g, '');
    document.getElementById('staffMonth').value = rawMonth;
    const preview = document.getElementById('staffMonthPreview');
    if (preview && rawMonth.length === 6) {
      preview.textContent = `â†’ ${rawMonth.substring(0,4)}ë…„ ${parseInt(rawMonth.substring(4,6))}ì›”`;
      preview.style.color = 'var(--accent)';
    }
    document.getElementById('staffNote').value = data.meta.note || '';
  }

  // Monthly
  const mBody = document.getElementById('staffMonthlyBody');
  mBody.innerHTML = '';
  const monthly = data.monthly ? Object.values(data.monthly) : [];
  if (monthly.length === 0) monthly.push({});
  monthly.forEach((r, i) => addStaffRowWithData('monthly', r, i + 1));

  // Yearly
  const yBody = document.getElementById('staffYearlyBody');
  yBody.innerHTML = '';
  const yearly = data.yearly ? Object.values(data.yearly) : [];
  if (yearly.length === 0) yearly.push({});
  yearly.forEach((r, i) => addStaffRowWithData('yearly', r, i + 1));
}

function editTeamData() {
  loadTeamDataToForm();
  switchStaffTab('input');
  setTimeout(() => {
    document.getElementById('staffInput').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);
  showToast('ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚´ìš©ì„ ìˆ˜ì • í›„ ì €ì¥í•´ ì£¼ì„¸ìš”.');
}

function addStaffRowWithData(type, data, num) {
  const tbody = document.getElementById(type === 'monthly' ? 'staffMonthlyBody' : 'staffYearlyBody');
  const d = data || {};

  if (type === 'monthly') {
    tbody.insertAdjacentHTML('beforeend', `<tr>
      <td><span class="row-num">${num}</span></td>
      <td><input type="text" placeholder="ì„œë¹„ìŠ¤ëª…" value="${d.service||''}"></td>
      <td><input type="text" placeholder="ê³µê¸‰ì—…ì²´" value="${d.vendor||''}"></td>
      <td><input type="text" placeholder="êµ¬ë§¤ ëª©ì " value="${d.purpose||''}"></td>
      <td><input type="text" placeholder="í”Œëœëª…" value="${d.plan||''}"></td>
      <td><input type="text" placeholder="ê¸ˆì•¡" value="${d.amount||''}"></td>
      <td><select><option ${d.cycle==='ì›”ë³„'?'selected':''}>ì›”ë³„</option></select></td>
      <td><input type="text" placeholder="ë§¤ì›” Nì¼" value="${d.payDate||''}"></td>
      <td><input type="text" placeholder="ë¶€ì„œ" value="${d.dept||''}"></td>
      <td><input type="text" placeholder="ì´ë©”ì¼" value="${d.account||''}"></td>
      <td><input type="text" placeholder="0000" value="${d.card||''}"></td>
      <td><input type="text" placeholder="-" value="${d.note||''}"></td>
      <td><button class="btn btn-danger" onclick="removeStaffRow(this)" style="padding:4px 7px;font-size:10px;">âœ•</button></td>
    </tr>`);
  } else {
    tbody.insertAdjacentHTML('beforeend', `<tr>
      <td><span class="row-num">${num}</span></td>
      <td><input type="text" placeholder="ì„œë¹„ìŠ¤ëª…" value="${d.service||''}"></td>
      <td><input type="text" placeholder="ê³µê¸‰ì—…ì²´" value="${d.vendor||''}"></td>
      <td><input type="text" placeholder="êµ¬ë§¤ ëª©ì " value="${d.purpose||''}"></td>
      <td><input type="text" placeholder="í”Œëœëª…" value="${d.plan||''}"></td>
      <td><input type="text" placeholder="ê¸ˆì•¡" value="${d.amount||''}"></td>
      <td><select><option ${d.cycle==='ì—°ê°„'?'selected':''}>ì—°ê°„</option></select></td>
      <td><input type="text" placeholder="ì‹œì‘~ì¢…ë£Œ" value="${d.period||''}"></td>
      <td><input type="text" placeholder="ê°±ì‹ ì¼" value="${d.renewDate||''}"></td>
      <td><input type="text" placeholder="ë¶€ì„œ" value="${d.dept||''}"></td>
      <td><input type="text" placeholder="ì´ë©”ì¼" value="${d.account||''}"></td>
      <td><input type="text" placeholder="0000" value="${d.card||''}"></td>
      <td><input type="text" placeholder="-" value="${d.note||''}"></td>
      <td><button class="btn btn-danger" onclick="removeStaffRow(this)" style="padding:4px 7px;font-size:10px;">âœ•</button></td>
    </tr>`);
  }
}

function addStaffRow(type) {
  const tbody = document.getElementById(type === 'monthly' ? 'staffMonthlyBody' : 'staffYearlyBody');
  addStaffRowWithData(type, {}, tbody.rows.length + 1);
  showToast('í–‰ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

function removeStaffRow(btn) {
  const row = btn.closest('tr');
  const tbody = row.parentNode;
  if (tbody.rows.length <= 1) { showToast('ìµœì†Œ 1í–‰ì€ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.'); return; }
  row.remove();
  Array.from(tbody.rows).forEach((r, i) => { const rn = r.querySelector('.row-num'); if (rn) rn.textContent = i + 1; });
}

function formatMonthValue(v) {
  const nums = (v||'').replace(/[^0-9]/g,'');
  if (nums.length === 6) return nums.substring(0,4) + '-' + nums.substring(4,6);
  return v; // ì´ë¯¸ 2026-01 í˜•ì‹ì´ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
}

function collectStaffData() {
  const meta = {
    team: currentTeam,
    writer: document.getElementById('staffWriter').value.trim(),
    month: formatMonthValue(document.getElementById('staffMonth').value),
    note: document.getElementById('staffNote').value.trim(),
    submittedAt: new Date().toISOString()
  };

  const monthly = {};
  let mIdx = 0;
  for (const row of document.getElementById('staffMonthlyBody').rows) {
    const inputs = row.querySelectorAll('input');
    const sel = row.querySelector('select');
    if (inputs[0]?.value.trim()) {
      monthly['m' + mIdx] = {
        service: inputs[0].value.trim(), vendor: inputs[1].value.trim(),
        purpose: inputs[2].value.trim(), plan: inputs[3].value.trim(),
        amount: inputs[4].value.trim(), cycle: sel ? sel.value : 'ì›”ë³„',
        payDate: inputs[5].value.trim(), dept: inputs[6].value.trim(),
        account: inputs[7].value.trim(), card: inputs[8].value.trim(),
        note: inputs[9].value.trim()
      };
      mIdx++;
    }
  }

  const yearly = {};
  let yIdx = 0;
  for (const row of document.getElementById('staffYearlyBody').rows) {
    const inputs = row.querySelectorAll('input');
    const sel = row.querySelector('select');
    if (inputs[0]?.value.trim()) {
      yearly['y' + yIdx] = {
        service: inputs[0].value.trim(), vendor: inputs[1].value.trim(),
        purpose: inputs[2].value.trim(), plan: inputs[3].value.trim(),
        amount: inputs[4].value.trim(), cycle: sel ? sel.value : 'ì—°ê°„',
        period: inputs[5].value.trim(), renewDate: inputs[6].value.trim(),
        dept: inputs[7].value.trim(), account: inputs[8].value.trim(),
        card: inputs[9].value.trim(), note: inputs[10].value.trim()
      };
      yIdx++;
    }
  }

  return { meta, monthly, yearly };
}

function saveToFirebase() {
  if (!currentTeam) { showToast('íŒ€ì„ ë¨¼ì € ì„ íƒí•´ ì£¼ì„¸ìš”.'); return; }
  const { meta, monthly, yearly } = collectStaffData();

  if (Object.keys(monthly).length === 0 && Object.keys(yearly).length === 0) {
    showToast('ì„œë¹„ìŠ¤ëª…ì„ 1ê±´ ì´ìƒ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return;
  }

  isSaving = true;
  fbDb.ref(DB_ROOT + '/' + currentTeam).set({ meta, monthly, yearly }).then(() => {
    isSaving = false;
    showToast('ì €ì¥ ì™„ë£Œ! ê²½ì˜ê´€ë¦¬íŒ€ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤.');
    updateSubmittedBanner();
  }).catch(err => {
    isSaving = false;
    showToast('ì €ì¥ ì˜¤ë¥˜: ' + err.message);
  });
}

function updateSubmittedBanner() {
  const banner = document.getElementById('submittedBanner');
  if (!currentTeam || !allTeamsData[currentTeam]) { banner.style.display = 'none'; return; }
  const data = allTeamsData[currentTeam];
  const mCount = data.monthly ? Object.keys(data.monthly).length : 0;
  const yCount = data.yearly ? Object.keys(data.yearly).length : 0;
  if (mCount > 0 || yCount > 0) {
    const submittedAt = data.meta?.submittedAt ? new Date(data.meta.submittedAt).toLocaleString('ko-KR') : '';
    banner.style.display = 'flex';
    banner.className = 'submitted-banner';
    banner.innerHTML = `<div class="check">âœ“</div><div class="info"><h4>${currentTeam} â€” ì œì¶œ ì™„ë£Œ</h4><p>ì›” ${mCount}ê±´, ì—° ${yCount}ê±´ ë“±ë¡ë¨${submittedAt ? ' Â· ìµœì¢… ì €ì¥: ' + submittedAt : ''}</p></div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-outline" onclick="editTeamData()">ìˆ˜ì •í•˜ê¸°</button>
      </div>`;
  } else {
    banner.style.display = 'none';
  }
}

function resetStaffForm() {
  if (!confirm('ì…ë ¥í•œ ë‚´ìš©ì„ ëª¨ë‘ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  ['staffWriter','staffMonth','staffNote'].forEach(id => document.getElementById(id).value = '');
  ['staffMonthlyBody','staffYearlyBody'].forEach(id => {
    const tbody = document.getElementById(id);
    tbody.innerHTML = '';
    addStaffRowWithData(id.includes('Monthly') ? 'monthly' : 'yearly', {}, 1);
  });
  showToast('ì´ˆê¸°í™” ì™„ë£Œ');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Staff: Preview
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderStaffPreview() {
  const { meta, monthly, yearly } = collectStaffData();
  const area = document.getElementById('previewContent');
  const mArr = Object.values(monthly);
  const yArr = Object.values(yearly);

  let html = `<div class="table-card">
    <div class="table-card-header"><h3>ë¯¸ë¦¬ë³´ê¸° â€” ${currentTeam || 'íŒ€ ë¯¸ì„ íƒ'}</h3></div>
    <div class="preview-meta">
      <span>íŒ€ëª…: <strong>${currentTeam || '-'}</strong></span>
      <span>ì‘ì„±ì: <strong>${meta.writer || '-'}</strong></span>
      <span>í•´ë‹¹ ì›”: <strong>${meta.month || '-'}</strong></span>
    </div></div>`;

  if (mArr.length > 0) {
    html += `<div class="table-card"><div class="table-card-header"><h3>ì›” ê²°ì œ ì„œë¹„ìŠ¤</h3><span class="example-badge badge-monthly">${mArr.length}ê±´</span></div>
      <div class="table-scroll"><table class="preview-table"><thead><tr>
        <th>No.</th><th>ì„œë¹„ìŠ¤ëª…</th><th>ê³µê¸‰ì—…ì²´</th><th>êµ¬ë§¤ ëª©ì </th><th>ì´ìš© í”Œëœ</th>
        <th>ì›” ê¸ˆì•¡</th><th>ê²°ì œì£¼ê¸°</th><th>ì •ê¸°ê²°ì œì¼</th><th>ì‚¬ìš© ë¶€ì„œ</th><th>ì‚¬ìš© ê³„ì •</th><th>ê²°ì œì¹´ë“œ</th>
      </tr></thead><tbody>`;
    mArr.forEach((r, i) => {
      html += `<tr><td><span class="row-num">${i+1}</span></td><td><strong>${r.service}</strong></td><td>${r.vendor}</td><td>${r.purpose}</td><td>${r.plan}</td><td><strong>${r.amount}</strong></td><td><span class="badge-cycle badge-monthly">${r.cycle}</span></td><td>${r.payDate}</td><td>${r.dept}</td><td style="font-size:11px">${r.account}</td><td><span class="card-chip">${r.card}</span></td></tr>`;
    });
    html += `</tbody></table></div></div>`;
  }

  if (yArr.length > 0) {
    html += `<div class="table-card"><div class="table-card-header"><h3>ì—° ê²°ì œ ì„œë¹„ìŠ¤</h3><span class="example-badge badge-yearly">${yArr.length}ê±´</span></div>
      <div class="table-scroll"><table class="preview-table"><thead><tr>
        <th>No.</th><th>ì„œë¹„ìŠ¤ëª…</th><th>ê³µê¸‰ì—…ì²´</th><th>êµ¬ë§¤ ëª©ì </th><th>ì´ìš© í”Œëœ</th>
        <th>ì—° ê¸ˆì•¡</th><th>ê²°ì œì£¼ê¸°</th><th>ê¸°ê°„</th><th>ê°±ì‹ ì¼</th><th>ì‚¬ìš© ë¶€ì„œ</th><th>ì‚¬ìš© ê³„ì •</th><th>ê²°ì œì¹´ë“œ</th>
      </tr></thead><tbody>`;
    yArr.forEach((r, i) => {
      html += `<tr><td><span class="row-num">${i+1}</span></td><td><strong>${r.service}</strong></td><td>${r.vendor}</td><td>${r.purpose}</td><td>${r.plan}</td><td><strong>${r.amount}</strong></td><td><span class="badge-cycle badge-yearly">${r.cycle}</span></td><td>${r.period}</td><td>${r.renewDate}</td><td>${r.dept}</td><td style="font-size:11px">${r.account}</td><td><span class="card-chip">${r.card}</span></td></tr>`;
    });
    html += `</tbody></table></div></div>`;
  }

  area.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Admin: Overview
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let adminCurrentTeam = null;

function renderTeamStatusForAdmin() {
  const grid = document.getElementById('teamStatusGrid');
  if (!grid) return;
  const teams = Object.keys(allTeamsData);
  grid.innerHTML = teams.map(t => {
    const d = allTeamsData[t];
    const mCount = d.monthly ? Object.keys(d.monthly).length : 0;
    const yCount = d.yearly ? Object.keys(d.yearly).length : 0;
    const submitted = mCount > 0 || yCount > 0;
    return `<div class="team-status-card ${submitted ? 'submitted' : 'not-submitted'}" onclick="adminSelectTeam('${t}')">
      <div class="team-status-name">${t}</div>
      <div class="team-status-badge ${submitted ? 'done' : 'pending'}">${submitted ? 'ì œì¶œ ì™„ë£Œ' : 'ë¯¸ì œì¶œ'}</div>
      <div class="team-status-detail">${submitted ? `ì›” ${mCount}ê±´, ì—° ${yCount}ê±´` : 'ëŒ€ê¸° ì¤‘'}</div>
    </div>`;
  }).join('') || '<div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--text-muted);">ì•„ì§ ë“±ë¡ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
}

function renderAdminView() {
  renderTeamStatusForAdmin();
  renderAdminTeamChips();
}

function renderAdminTeamChips() {
  const teams = Object.keys(allTeamsData);
  ['adminTeamChips'].forEach(containerId => {
    const container = document.getElementById(containerId);
    if (!container) return;
    container.innerHTML = teams.map((t, i) => {
      return `<div class="team-chip ${t === adminCurrentTeam ? 'active' : ''}" onclick="adminSelectTeam('${t}')">${t}</div>`;
    }).join('');
  });
  if (!adminCurrentTeam && teams.length > 0) {
    adminCurrentTeam = teams[0];
    renderAdminTeamDetail();
  }
}

function adminSelectTeam(team) {
  adminCurrentTeam = team;
  renderAdminTeamChips();
  renderAdminTeamDetail();
}

function renderAdminTeamDetail() {
  if (!adminCurrentTeam || !allTeamsData[adminCurrentTeam]) return;
  const area = document.getElementById('adminTeamDetail');
  const data = allTeamsData[adminCurrentTeam];
  const mArr = data.monthly ? Object.values(data.monthly) : [];
  const yArr = data.yearly ? Object.values(data.yearly) : [];

  let html = `<div class="table-card"><div class="table-card-header"><h3>${adminCurrentTeam} ìƒì„¸</h3>
      <div style="display:flex;gap:8px;align-items:center;">
        <button class="btn btn-csv" onclick="downloadCurrentTeamCSV()" style="display:flex;align-items:center;gap:5px;font-size:12px;">ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</button>
        <button class="btn btn-danger" onclick="adminDeleteTeamData('${adminCurrentTeam}')" style="font-size:12px;padding:6px 14px;">ğŸ—‘ ë°ì´í„° ì‚­ì œ</button>
      </div>
    </div>
    <div class="preview-meta">
      <span>ì‘ì„±ì: <strong>${data.meta?.writer||'-'}</strong></span>
      <span>í•´ë‹¹ ì›”: <strong>${data.meta?.month||'-'}</strong></span>
      <span>ìµœì¢… ì €ì¥: <strong>${data.meta?.submittedAt ? new Date(data.meta.submittedAt).toLocaleString('ko-KR') : '-'}</strong></span>
    </div></div>`;

  if (mArr.length > 0) {
    html += `<div class="table-card"><div class="table-card-header"><h3>ì›” ê²°ì œ â€” ${adminCurrentTeam}</h3><span class="example-badge badge-monthly">${mArr.length}ê±´</span></div>
      <div class="table-scroll"><table class="preview-table"><thead><tr><th>No.</th><th>ì„œë¹„ìŠ¤ëª…</th><th>ê³µê¸‰ì—…ì²´</th><th>êµ¬ë§¤ ëª©ì </th><th>í”Œëœ</th><th>ì›” ê¸ˆì•¡</th><th>ê²°ì œì£¼ê¸°</th><th>ì •ê¸°ê²°ì œì¼</th><th>ë¶€ì„œ</th><th>ê³„ì •</th><th>ì¹´ë“œ</th><th>ë¹„ê³ </th></tr></thead><tbody>`;
    mArr.forEach((r, i) => {
      html += `<tr><td>${i+1}</td><td><strong>${r.service}</strong></td><td>${r.vendor}</td><td>${r.purpose}</td><td>${r.plan}</td><td><strong>${r.amount}</strong></td><td>${r.cycle}</td><td>${r.payDate}</td><td>${r.dept}</td><td style="font-size:11px">${r.account}</td><td><span class="card-chip">${r.card}</span></td><td>${r.note||''}</td></tr>`;
    });
    html += `</tbody></table></div></div>`;
  }

  if (yArr.length > 0) {
    html += `<div class="table-card"><div class="table-card-header"><h3>ì—° ê²°ì œ â€” ${adminCurrentTeam}</h3><span class="example-badge badge-yearly">${yArr.length}ê±´</span></div>
      <div class="table-scroll"><table class="preview-table"><thead><tr><th>No.</th><th>ì„œë¹„ìŠ¤ëª…</th><th>ê³µê¸‰ì—…ì²´</th><th>êµ¬ë§¤ ëª©ì </th><th>í”Œëœ</th><th>ì—° ê¸ˆì•¡</th><th>ê²°ì œì£¼ê¸°</th><th>ê¸°ê°„</th><th>ê°±ì‹ ì¼</th><th>ë¶€ì„œ</th><th>ê³„ì •</th><th>ì¹´ë“œ</th><th>ë¹„ê³ </th></tr></thead><tbody>`;
    yArr.forEach((r, i) => {
      html += `<tr><td>${i+1}</td><td><strong>${r.service}</strong></td><td>${r.vendor}</td><td>${r.purpose}</td><td>${r.plan}</td><td><strong>${r.amount}</strong></td><td>${r.cycle}</td><td>${r.period}</td><td>${r.renewDate}</td><td>${r.dept}</td><td style="font-size:11px">${r.account}</td><td><span class="card-chip">${r.card}</span></td><td>${r.note||''}</td></tr>`;
    });
    html += `</tbody></table></div></div>`;
  }

  if (mArr.length === 0 && yArr.length === 0) {
    html += `<div class="card" style="text-align:center;padding:40px;color:var(--text-muted);">ì´ íŒ€ì€ ì•„ì§ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>`;
  }

  area.innerHTML = html;
}

function adminDeleteTeamData(teamName) {
  if (!confirm(`âš ï¸ "${teamName}" íŒ€ì˜ ëª¨ë“  ì§€ì¶œ ë°ì´í„°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.\n\nì‚­ì œ í›„ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  if (!confirm(`ì •ë§ë¡œ "${teamName}" ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ìµœì¢… í™•ì¸)`)) return;
  fbDb.ref(DB_ROOT + '/' + teamName).remove().then(() => {
    adminCurrentTeam = null;
    showToast(`${teamName} ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
  }).catch(err => {
    showToast('ì‚­ì œ ì˜¤ë¥˜: ' + err.message);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Admin: ì „ì²´ ìƒì„¸ í™•ì¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAdminAllDetail() {
  const area = document.getElementById('adminAllDetail');
  const teams = Object.keys(allTeamsData);
  if (teams.length === 0) {
    area.innerHTML = '<div class="card" style="text-align:center;padding:40px;color:var(--text-muted);">ì•„ì§ ë“±ë¡ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
    return;
  }

  let html = '';
  let grandMonthly = 0, grandYearly = 0, grandTotal = 0;

  teams.forEach(teamName => {
    const data = allTeamsData[teamName];
    const mArr = data.monthly ? Object.values(data.monthly) : [];
    const yArr = data.yearly ? Object.values(data.yearly) : [];
    if (mArr.length === 0 && yArr.length === 0) return;

    const safeTeam = teamName.replace(/\s/g,'_');
    let teamMonthlyTotal = 0, teamYearlyTotal = 0;

    html += `<div class="table-card" style="margin-bottom:24px;">
      <div class="table-card-header" style="border-bottom:2px solid var(--primary);">
        <h3 style="font-size:15px;">ğŸ¢ ${teamName}</h3>
        <div style="display:flex;align-items:center;gap:10px;">
          <span class="preview-meta" style="margin:0;"><span>ì‘ì„±ì: <strong>${data.meta?.writer||'-'}</strong></span> Â· <span>í•´ë‹¹ ì›”: <strong>${data.meta?.month||'-'}</strong></span></span>
          <button class="btn btn-csv" onclick="adminDownloadTeamCSV('${teamName}')" style="font-size:11px;padding:5px 12px;">ğŸ“¥ CSV</button>
        </div>
      </div>`;

    if (mArr.length > 0) {
      html += `<div style="padding:0 16px;"><div style="font-size:13px;font-weight:600;color:var(--accent);padding:12px 0 6px;display:flex;align-items:center;gap:6px;">ì›” ê²°ì œ ì„œë¹„ìŠ¤ <span class="example-badge badge-monthly">${mArr.length}ê±´</span></div>
        <div class="table-scroll"><table class="preview-table"><thead><tr><th>No.</th><th>ì„œë¹„ìŠ¤ëª…</th><th>ê³µê¸‰ì—…ì²´</th><th>êµ¬ë§¤ ëª©ì </th><th>í”Œëœ</th><th>ì›” ê¸ˆì•¡</th><th>ê²°ì œì£¼ê¸°</th><th>ì •ê¸°ê²°ì œì¼</th><th>ë¶€ì„œ</th><th>ê³„ì •</th><th>ì¹´ë“œ</th><th>ë¹„ê³ </th></tr></thead><tbody>`;
      mArr.forEach((r, i) => {
        const amt = parseAmount(r.amount); teamMonthlyTotal += amt;
        html += `<tr><td>${i+1}</td><td><strong>${r.service}</strong></td><td>${r.vendor}</td><td>${r.purpose}</td><td>${r.plan}</td><td><strong>${r.amount}</strong></td><td>${r.cycle}</td><td>${r.payDate}</td><td>${r.dept}</td><td style="font-size:11px">${r.account}</td><td><span class="card-chip">${r.card}</span></td><td>${r.note||''}</td></tr>`;
      });
      html += `<tr style="background:var(--accent-soft);font-weight:600;"><td colspan="5" style="text-align:center;">ì›” ê²°ì œ ì†Œê³„</td><td colspan="7" style="text-align:left;padding-left:8px;">${formatNumber(teamMonthlyTotal)}</td></tr>`;
      html += `</tbody></table></div></div>`;
    }

    if (yArr.length > 0) {
      html += `<div style="padding:0 16px;"><div style="font-size:13px;font-weight:600;color:#8B5CF6;padding:12px 0 6px;display:flex;align-items:center;gap:6px;">ì—° ê²°ì œ ì„œë¹„ìŠ¤ <span class="example-badge badge-yearly">${yArr.length}ê±´</span></div>
        <div class="table-scroll"><table class="preview-table"><thead><tr><th>No.</th><th>ì„œë¹„ìŠ¤ëª…</th><th>ê³µê¸‰ì—…ì²´</th><th>êµ¬ë§¤ ëª©ì </th><th>í”Œëœ</th><th>ì—° ê¸ˆì•¡</th><th>ê²°ì œì£¼ê¸°</th><th>ê¸°ê°„</th><th>ê°±ì‹ ì¼</th><th>ë¶€ì„œ</th><th>ê³„ì •</th><th>ì¹´ë“œ</th><th>ë¹„ê³ </th></tr></thead><tbody>`;
      yArr.forEach((r, i) => {
        const amt = parseAmount(r.amount); teamYearlyTotal += amt;
        html += `<tr><td>${i+1}</td><td><strong>${r.service}</strong></td><td>${r.vendor}</td><td>${r.purpose}</td><td>${r.plan}</td><td><strong>${r.amount}</strong></td><td>${r.cycle}</td><td>${r.period}</td><td>${r.renewDate}</td><td>${r.dept}</td><td style="font-size:11px">${r.account}</td><td><span class="card-chip">${r.card}</span></td><td>${r.note||''}</td></tr>`;
      });
      html += `<tr style="background:#EDE9FE;font-weight:600;"><td colspan="5" style="text-align:center;">ì—° ê²°ì œ ì†Œê³„</td><td colspan="8" style="text-align:left;padding-left:8px;">${formatNumber(teamYearlyTotal)}</td></tr>`;
      html += `</tbody></table></div></div>`;
    }

    const teamTotal = teamMonthlyTotal + teamYearlyTotal;
    html += `<div style="padding:12px 16px;background:var(--bg-warm);border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;font-size:13px;">
      <span style="color:var(--text-secondary);">ì›” ${mArr.length}ê±´ Â· ì—° ${yArr.length}ê±´</span>
      <span style="font-weight:700;color:var(--primary);font-size:14px;">${teamName} í•©ê³„: ${formatNumber(teamTotal)}</span>
    </div></div>`;

    grandMonthly += teamMonthlyTotal;
    grandYearly += teamYearlyTotal;
    grandTotal += teamTotal;
  });

  // ì „ì²´ ì´ê³„ ìš”ì•½
  if (grandTotal > 0) {
    html = `<div class="card" style="background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;margin-bottom:20px;">
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;text-align:center;">
        <div><div style="font-size:12px;opacity:0.7;margin-bottom:4px;">ì›” ê²°ì œ í•©ê³„</div><div style="font-size:20px;font-weight:700;">${formatNumber(grandMonthly)}</div></div>
        <div><div style="font-size:12px;opacity:0.7;margin-bottom:4px;">ì—° ê²°ì œ í•©ê³„</div><div style="font-size:20px;font-weight:700;">${formatNumber(grandYearly)}</div></div>
        <div><div style="font-size:12px;opacity:0.7;margin-bottom:4px;">ì „ì²´ í•©ê³„</div><div style="font-size:22px;font-weight:800;">${formatNumber(grandTotal)}</div></div>
      </div>
    </div>` + html;
  }

  area.innerHTML = html || '<div class="card" style="text-align:center;padding:40px;color:var(--text-muted);">ì œì¶œëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
}

function adminDownloadTeamCSV(teamName) {
  const csv = buildCSVForTeam(teamName);
  if (csv) {
    const month = allTeamsData[teamName]?.meta?.month?.replace('-','') || 'YYYYMM';
    downloadBlobFile(csv, `ë²•ì¸ì¹´ë“œ_ê³ ì •ì§€ì¶œ_${teamName}_${month}.csv`, 'text/csv;charset=utf-8;');
    showToast(`${teamName} CSV ë‹¤ìš´ë¡œë“œ ì™„ë£Œ`);
  } else {
    showToast('í•´ë‹¹ íŒ€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Admin: Approval Form
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderApprovalView() {
  renderAdminTeamChips();
  if (adminCurrentTeam) renderApprovalForTeam(adminCurrentTeam);
}

function parseAmount(str) { return parseFloat((str||'').replace(/[^0-9.-]/g,'')) || 0; }
function formatNumber(num) { return num.toLocaleString('ko-KR'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Staff: í’ˆì˜ì„œ ì–‘ì‹ ë³€í™˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderStaffApprovalForm() {
  const area = document.getElementById('staffApprovalFormsArea');
  // ìë™ìœ¼ë¡œ ì„ íƒëœ íŒ€/ì‘ì„±ì ì •ë³´ í‘œì‹œ
  const teamDisplay = document.getElementById('staffApprovalTeamDisplay');
  const userDisplay = document.getElementById('staffApprovalUserDisplay');
  if (teamDisplay) teamDisplay.textContent = currentTeam || 'íŒ€ ë¯¸ì„ íƒ';
  const writerName = document.getElementById('staffWriter')?.value?.trim() || '';
  if (userDisplay) userDisplay.textContent = currentTeam ? (writerName || currentTeam) : '-';

  if (!currentTeam) { area.innerHTML = '<div class="card" style="text-align:center;padding:40px;color:var(--text-muted);">ë¨¼ì € íŒ€ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>'; return; }
  if (!allTeamsData[currentTeam]) { area.innerHTML = '<div class="card" style="text-align:center;padding:40px;color:var(--text-muted);">ì œì¶œëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë‚´ì—­ì„ ì…ë ¥í•˜ê³  ì €ì¥í•´ ì£¼ì„¸ìš”.</div>'; return; }

  const data = allTeamsData[currentTeam];
  const user = writerName || currentTeam;
  const ps = document.getElementById('staffApprovalStart').value || '';
  const pe = document.getElementById('staffApprovalEnd').value || '';
  const period = ps && pe ? `${ps} ~ ${pe}` : 'ê¸°ê°„ ë¯¸ì„¤ì •';

  let totalAmount = 0;
  const allItems = [];

  (data.monthly ? Object.values(data.monthly) : []).forEach(r => {
    const amt = parseAmount(r.amount); totalAmount += amt;
    allItems.push({ ...r, amountNum: amt, type: 'monthly' });
  });
  (data.yearly ? Object.values(data.yearly) : []).forEach(r => {
    const amt = parseAmount(r.amount); totalAmount += amt;
    allItems.push({ ...r, amountNum: amt, type: 'yearly' });
  });

  if (allItems.length === 0) { area.innerHTML = '<div class="card" style="text-align:center;padding:40px;color:var(--text-muted);">ë“±ë¡ëœ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }

  const safeTeam = currentTeam.replace(/\s/g,'_');

  let html = `<div class="approval-block" id="staffApprovalBlock_${safeTeam}">
    <div class="approval-block-title">${currentTeam} â€” ë²•ì¸ì¹´ë“œ ì‚¬ìš© í’ˆì˜ì„œ</div>
    <div class="table-card" style="overflow:visible;">
      <div class="table-card-header"><h3>í’ˆì˜ì„œ ì‘ì„± í™œìš© ì–‘ì‹</h3>
        <button class="btn btn-primary" onclick="copyTable('staffAppTable_${safeTeam}')">í…Œì´ë¸” ë³µì‚¬</button>
      </div>
      <div style="padding:16px;">
        <table class="approval-table" id="staffAppTable_${safeTeam}">
          <colgroup><col style="width:25%"><col style="width:25%"><col style="width:25%"><col style="width:25%"></colgroup>
          <thead><tr><th colspan="4" style="background:#1B2A4A;color:#fff;font-size:15px;padding:14px;">ë²•ì¸ì¹´ë“œ ì‚¬ìš© í’ˆì˜ì„œ</th></tr></thead>
          <tbody>
            <tr><td class="cat-label">1. ì‚¬ìš©ì</td><td colspan="3">${user}</td></tr>
            <tr><td class="cat-label">2. ì¹´ë“œì‚¬ìš©ê¸°ê°„</td><td colspan="3">${period}</td></tr>
            <tr><td colspan="4" class="section-header">3. ì‚¬ìš© ìƒì„¸ê¸ˆì•¡</td></tr>
            <tr><td class="cat-label">ê¸°íƒ€ (ê³ ì •ì§€ì¶œ)</td><td class="amount-cell" colspan="3">${formatNumber(totalAmount)}</td></tr>
            <tr class="total-row"><td style="font-weight:700;">í•©ê³„</td><td class="amount-cell" colspan="3">${formatNumber(totalAmount)}</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="table-card" style="overflow:visible;">
      <div class="table-card-header"><h3>ë²•ì¸ì¹´ë“œ ì‚¬ìš©ë‚´ì—­ ë¦¬ìŠ¤íŠ¸</h3>
        <button class="btn btn-primary" onclick="copyTable('staffUsageTable_${safeTeam}')">í…Œì´ë¸” ë³µì‚¬</button>
      </div>
      <div style="padding:16px;">
        <table class="usage-list-table" id="staffUsageTable_${safeTeam}">
          <thead><tr><th>ë²ˆí˜¸</th><th>ì„œë¹„ìŠ¤ëª…</th><th>ê³µê¸‰ì—…ì²´</th><th>í•©ê³„</th><th>ê²°ì œì£¼ê¸°</th><th>ê²°ì œì¼/ê¸°ê°„</th><th>ê²°ì œì¹´ë“œ</th><th>ì§€ì¶œë¶„ë¥˜</th><th>ì‚¬ìš©ë‚´ì—­</th></tr></thead>
          <tbody>`;
  allItems.forEach((it, idx) => {
    const dp = it.type === 'monthly' ? (it.payDate||'') : (it.period||'');
    html += `<tr><td>${idx+1}</td><td style="text-align:left;padding-left:8px;font-weight:600;">${it.service}</td><td>${it.vendor||''}</td><td style="text-align:right;padding-right:8px;font-weight:600;">${it.amount}</td><td>${it.cycle||''}</td><td>${dp}</td><td>${it.card||''}</td><td>ê¸°íƒ€</td><td style="text-align:left;padding-left:8px;">${it.purpose||''}</td></tr>`;
  });
  html += `</tbody><tfoot><tr style="background:#EFF6FF;font-weight:700;"><td colspan="3" style="border:1px solid #999;padding:10px;text-align:center;">í•©ê³„</td><td style="border:1px solid #999;text-align:right;padding-right:8px;">${formatNumber(totalAmount)}</td><td colspan="5" style="border:1px solid #999;"></td></tr></tfoot>
        </table>
      </div>
    </div>
  </div>`;

  area.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Staff: CSV ë‹¤ìš´ë¡œë“œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function downloadMyTeamCSV() {
  if (!currentTeam) { showToast('ë¨¼ì € íŒ€ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.'); return; }
  const csv = buildCSVForTeam(currentTeam);
  if (csv) {
    const month = allTeamsData[currentTeam]?.meta?.month?.replace('-','') || 'YYYYMM';
    downloadBlobFile(csv, `ë²•ì¸ì¹´ë“œ_ê³ ì •ì§€ì¶œ_${currentTeam}_${month}.csv`, 'text/csv;charset=utf-8;');
    showToast(`${currentTeam} CSV ë‹¤ìš´ë¡œë“œ ì™„ë£Œ`);
  } else {
    showToast('ì œì¶œëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë‚´ì—­ì„ ì…ë ¥í•˜ê³  ì €ì¥í•´ ì£¼ì„¸ìš”.');
  }
}

function renderApprovalForTeam(teamName) {
  const area = document.getElementById('approvalFormsArea');
  if (!allTeamsData[teamName]) { area.innerHTML = ''; return; }
  const data = allTeamsData[teamName];
  const user = document.getElementById('approvalUser').value.trim() || 'ë³¸ì‚¬';
  const ps = document.getElementById('approvalStart').value || '';
  const pe = document.getElementById('approvalEnd').value || '';
  const period = ps && pe ? `${ps} ~ ${pe}` : 'ê¸°ê°„ ë¯¸ì„¤ì •';

  let totalAmount = 0;
  const allItems = [];

  (data.monthly ? Object.values(data.monthly) : []).forEach(r => {
    const amt = parseAmount(r.amount); totalAmount += amt;
    allItems.push({ ...r, amountNum: amt, type: 'monthly' });
  });
  (data.yearly ? Object.values(data.yearly) : []).forEach(r => {
    const amt = parseAmount(r.amount); totalAmount += amt;
    allItems.push({ ...r, amountNum: amt, type: 'yearly' });
  });

  const safeTeam = teamName.replace(/\s/g,'_');

  let html = `<div class="approval-block" id="approvalBlock_${safeTeam}">
    <div class="approval-block-title">${teamName} â€” ë²•ì¸ì¹´ë“œ ì‚¬ìš© í’ˆì˜ì„œ</div>
    <div class="table-card" style="overflow:visible;">
      <div class="table-card-header"><h3>í’ˆì˜ì„œ ì‘ì„± í™œìš© ì–‘ì‹</h3>
        <button class="btn btn-primary" onclick="copyTable('appTable_${safeTeam}')">í…Œì´ë¸” ë³µì‚¬</button>
      </div>
      <div style="padding:16px;">
        <table class="approval-table" id="appTable_${safeTeam}">
          <colgroup><col style="width:25%"><col style="width:25%"><col style="width:25%"><col style="width:25%"></colgroup>
          <thead><tr><th colspan="4" style="background:#1B2A4A;color:#fff;font-size:15px;padding:14px;">ë²•ì¸ì¹´ë“œ ì‚¬ìš© í’ˆì˜ì„œ</th></tr></thead>
          <tbody>
            <tr><td class="cat-label">1. ì‚¬ìš©ì</td><td colspan="3">${user}</td></tr>
            <tr><td class="cat-label">2. ì¹´ë“œì‚¬ìš©ê¸°ê°„</td><td colspan="3">${period}</td></tr>
            <tr><td colspan="4" class="section-header">3. ì‚¬ìš© ìƒì„¸ê¸ˆì•¡</td></tr>
            <tr><td class="cat-label">ê¸°íƒ€ (ê³ ì •ì§€ì¶œ)</td><td class="amount-cell" colspan="3">${formatNumber(totalAmount)}</td></tr>
            <tr class="total-row"><td style="font-weight:700;">í•©ê³„</td><td class="amount-cell" colspan="3">${formatNumber(totalAmount)}</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="table-card" style="overflow:visible;">
      <div class="table-card-header"><h3>ë²•ì¸ì¹´ë“œ ì‚¬ìš©ë‚´ì—­ ë¦¬ìŠ¤íŠ¸</h3>
        <button class="btn btn-primary" onclick="copyTable('usageTable_${safeTeam}')">í…Œì´ë¸” ë³µì‚¬</button>
      </div>
      <div style="padding:16px;">
        <table class="usage-list-table" id="usageTable_${safeTeam}">
          <thead><tr><th>ë²ˆí˜¸</th><th>ì„œë¹„ìŠ¤ëª…</th><th>ê³µê¸‰ì—…ì²´</th><th>í•©ê³„</th><th>ê²°ì œì£¼ê¸°</th><th>ê²°ì œì¼/ê¸°ê°„</th><th>ê²°ì œì¹´ë“œ</th><th>ì§€ì¶œë¶„ë¥˜</th><th>ì‚¬ìš©ë‚´ì—­</th></tr></thead>
          <tbody>`;
  allItems.forEach((it, idx) => {
    const dp = it.type === 'monthly' ? (it.payDate||'') : (it.period||'');
    html += `<tr><td>${idx+1}</td><td style="text-align:left;padding-left:8px;font-weight:600;">${it.service}</td><td>${it.vendor||''}</td><td style="text-align:right;padding-right:8px;font-weight:600;">${it.amount}</td><td>${it.cycle||''}</td><td>${dp}</td><td>${it.card||''}</td><td>ê¸°íƒ€</td><td style="text-align:left;padding-left:8px;">${it.purpose||''}</td></tr>`;
  });
  html += `</tbody><tfoot><tr style="background:#EFF6FF;font-weight:700;"><td colspan="3" style="border:1px solid #999;padding:10px;text-align:center;">í•©ê³„</td><td style="border:1px solid #999;text-align:right;padding-right:8px;">${formatNumber(totalAmount)}</td><td colspan="5" style="border:1px solid #999;"></td></tr></tfoot>
        </table>
      </div>
    </div>
  </div>`;

  area.innerHTML = html;
}

function copyTable(tableId) {
  const table = document.getElementById(tableId);
  if (!table) return;
  const range = document.createRange();
  range.selectNode(table);
  const sel = window.getSelection();
  sel.removeAllRanges(); sel.addRange(range);
  try { document.execCommand('copy'); showToast('í…Œì´ë¸” ë³µì‚¬ ì™„ë£Œ! í•˜ì´ì›ìŠ¤ í’ˆì˜ì„œì— Ctrl+Vë¡œ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.'); }
  catch(e) { showToast('ë³µì‚¬ ì‹¤íŒ¨. ìˆ˜ë™ìœ¼ë¡œ ì„ íƒ í›„ ë³µì‚¬í•´ ì£¼ì„¸ìš”.'); }
  sel.removeAllRanges();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Admin: CSV Download
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function csvSafe(s) { return (s||'').replace(/"/g,'""'); }

function downloadBlobFile(content, filename, type) {
  const blob = new Blob([content], { type });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = filename;
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function buildCSVForTeam(teamName) {
  const data = allTeamsData[teamName];
  if (!data) return null;
  const BOM = '\uFEFF';
  let csv = BOM;
  csv += `"ì†Œì† íŒ€","ì‘ì„±ì","ì‘ì„±ì¼","í•´ë‹¹ ì›”"\n`;
  csv += `"${csvSafe(teamName)}","${csvSafe(data.meta?.writer)}","${csvSafe(data.meta?.submittedAt?.split('T')[0])}","${csvSafe(data.meta?.month)}"\n\n`;

  const mArr = data.monthly ? Object.values(data.monthly) : [];
  if (mArr.length > 0) {
    csv += `"[ì›” ê²°ì œ ì„œë¹„ìŠ¤]"\n"No.","ì„œë¹„ìŠ¤ëª…","ê³µê¸‰ì—…ì²´","êµ¬ë§¤ ëª©ì ","ì´ìš© í”Œëœ","ì›” ê¸ˆì•¡","ê²°ì œì£¼ê¸°","ì •ê¸°ê²°ì œì¼","ì‚¬ìš© ë¶€ì„œ","ì‚¬ìš© ê³„ì •","ê²°ì œì¹´ë“œ(ë4ìë¦¬)","ë¹„ê³ "\n`;
    mArr.forEach((r, i) => {
      csv += `"${i+1}","${csvSafe(r.service)}","${csvSafe(r.vendor)}","${csvSafe(r.purpose)}","${csvSafe(r.plan)}","${csvSafe(r.amount)}","${csvSafe(r.cycle)}","${csvSafe(r.payDate)}","${csvSafe(r.dept)}","${csvSafe(r.account)}","${csvSafe(r.card)}","${csvSafe(r.note)}"\n`;
    });
    csv += '\n';
  }

  const yArr = data.yearly ? Object.values(data.yearly) : [];
  if (yArr.length > 0) {
    csv += `"[ì—° ê²°ì œ ì„œë¹„ìŠ¤]"\n"No.","ì„œë¹„ìŠ¤ëª…","ê³µê¸‰ì—…ì²´","êµ¬ë§¤ ëª©ì ","ì´ìš© í”Œëœ","ì—° ê¸ˆì•¡","ê²°ì œì£¼ê¸°","ê¸°ê°„","ê°±ì‹ ì¼","ì‚¬ìš© ë¶€ì„œ","ì‚¬ìš© ê³„ì •","ê²°ì œì¹´ë“œ(ë4ìë¦¬)","ë¹„ê³ "\n`;
    yArr.forEach((r, i) => {
      csv += `"${i+1}","${csvSafe(r.service)}","${csvSafe(r.vendor)}","${csvSafe(r.purpose)}","${csvSafe(r.plan)}","${csvSafe(r.amount)}","${csvSafe(r.cycle)}","${csvSafe(r.period)}","${csvSafe(r.renewDate)}","${csvSafe(r.dept)}","${csvSafe(r.account)}","${csvSafe(r.card)}","${csvSafe(r.note)}"\n`;
    });
  }

  return csv;
}

function downloadAllCSV() {
  const teams = Object.keys(allTeamsData);
  if (teams.length === 0) { showToast('ë“±ë¡ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
  let count = 0;
  teams.forEach(t => {
    const csv = buildCSVForTeam(t);
    if (csv) {
      const month = allTeamsData[t].meta?.month?.replace('-','') || 'YYYYMM';
      downloadBlobFile(csv, `ë²•ì¸ì¹´ë“œ_ê³ ì •ì§€ì¶œ_${t}_${month}.csv`, 'text/csv;charset=utf-8;');
      count++;
    }
  });
  showToast(`${count}ê°œ íŒ€ CSV ë‹¤ìš´ë¡œë“œ ì™„ë£Œ`);
}

function downloadCurrentTeamCSV() {
  if (!adminCurrentTeam) { showToast('íŒ€ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.'); return; }
  const csv = buildCSVForTeam(adminCurrentTeam);
  if (csv) {
    const month = allTeamsData[adminCurrentTeam].meta?.month?.replace('-','') || 'YYYYMM';
    downloadBlobFile(csv, `ë²•ì¸ì¹´ë“œ_ê³ ì •ì§€ì¶œ_${adminCurrentTeam}_${month}.csv`, 'text/csv;charset=utf-8;');
    showToast(`${adminCurrentTeam} CSV ë‹¤ìš´ë¡œë“œ ì™„ë£Œ`);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Toast
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  clearTimeout(t._timer);
  t._timer = setTimeout(() => t.classList.remove('show'), 2500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Init
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  const today = new Date();
  const monthStr = today.getFullYear() + String(today.getMonth()+1).padStart(2,'0');
  const staffMonthInput = document.getElementById('staffMonth');
  staffMonthInput.value = monthStr;
  updateMonthPreview(monthStr);

  // í•´ë‹¹ ì›” ìë™ í¬ë§· (202601 â†’ 2026-01)
  staffMonthInput.addEventListener('input', function() {
    let v = this.value.replace(/[^0-9]/g, ''); // ìˆ«ìë§Œ ë‚¨ê¸°ê¸°
    if (v.length > 6) v = v.substring(0, 6);
    this.value = v;
    updateMonthPreview(v);
  });

  function updateMonthPreview(v) {
    const preview = document.getElementById('staffMonthPreview');
    if (v.length === 6) {
      const y = v.substring(0, 4);
      const m = v.substring(4, 6);
      const mi = parseInt(m);
      if (mi >= 1 && mi <= 12) {
        preview.textContent = `â†’ ${y}ë…„ ${mi}ì›”`;
        preview.style.color = 'var(--accent)';
      } else {
        preview.textContent = 'âš  ì›”ì€ 01~12 ì‚¬ì´ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”';
        preview.style.color = 'var(--danger)';
      }
    } else if (v.length > 0) {
      preview.textContent = `ìˆ«ì 6ìë¦¬ ì…ë ¥ (ì˜ˆ: ${today.getFullYear()}${String(today.getMonth()+1).padStart(2,'0')})`;
      preview.style.color = 'var(--text-muted)';
    } else {
      preview.textContent = '';
    }
  }

  // Staff Approval period defaults (previous month)
  const year = today.getFullYear();
  const month = today.getMonth();
  const prevMonth = month === 0 ? 12 : month;
  const prevYear = month === 0 ? year - 1 : year;
  const lastDay = new Date(prevYear, prevMonth, 0).getDate();
  document.getElementById('staffApprovalStart').value = `${prevYear}-${String(prevMonth).padStart(2,'0')}-01`;
  document.getElementById('staffApprovalEnd').value = `${prevYear}-${String(prevMonth).padStart(2,'0')}-${String(lastDay).padStart(2,'0')}`;

  // Restore writer name
  const savedWriter = localStorage.getItem('cc_fixed_writer');
  if (savedWriter) document.getElementById('staffWriter').value = savedWriter;
  document.getElementById('staffWriter').addEventListener('blur', function() {
    localStorage.setItem('cc_fixed_writer', this.value.trim());
  });

  initFirebase();
});
</script>
</body>
</html>
